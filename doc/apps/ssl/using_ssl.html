<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.34.1">
    <meta name="project" content="ssl v11.2.4">


<meta name="exdoc:full-text-search-url" content="/doc/search.html?v=27&q=">
<meta name="major-vsn" content="27">
<link rel="canonical" href="https://www.erlang.org/doc/apps/ssl/using_ssl.html" />
    <title>Examples — ssl v11.2.4</title>
    <link rel="stylesheet" href="dist/html-erlang-APNLKZCW.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-E929C88D.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-7XSQ4GTY.js"></script>

  </head>
  <body data-type="extras" class="page-extra">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="../../index.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="ssl" />
        </a>

      <div>
        <a href="../../index.html" class="sidebar-projectName" translate="no">
ssl
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v11.2.4
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of ssl</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/erlang/otp/blob/OTP-27.1.2/lib/ssl/doc/guides/using_ssl.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>


    <span>Examples</span>
  </h1>

<p>To see relevant version information for ssl, call <a href="ssl.html#versions/0"><code class="inline">ssl:versions/0</code></a> .</p><p>To see all supported cipher suites, call
<a href="ssl.html#cipher_suites/2"><code class="inline">ssl:cipher_suites(all, 'tlsv1.3')</code> </a>. The available
cipher suites for a connection depend on the TLS version and prior to TLS-1.3 also on
the certificate. To see the default cipher suite list change <code class="inline">all</code> to <code class="inline">default</code>.
Note that TLS 1.3 and previous versions do not have any cipher suites in common,
for listing cipher suites for a specific version use
<a href="ssl.html#cipher_suites/2"><code class="inline">ssl:cipher_suites(exclusive, 'tlsv1.3')</code> </a>. Specific
cipher suites that you want your connection to use can also be specified.
Default is to use the strongest available.</p><blockquote><h4 class="warning">Warning</h4><p>Enabling cipher suites using RSA as a key exchange algorithm is
strongly discouraged (only available prior to TLS-1.3). For some
configurations software preventions may exist, and can make them usable if they work,
but relying on them to work is risky and there are many more reliable
cipher suites that can be used instead.</p></blockquote><p>The following sections shows small examples of how to set up client/server
connections using the Erlang shell. The returned value of the <code class="inline">sslsocket</code> is
abbreviated with <code class="inline">[...]</code> as it can be fairly large and is opaque to the user
except for the purpose of pattern matching.</p><blockquote><h4 class="info">Note</h4><p>Note that client certificate verification is optional for the server and needs
additional conguration on both sides to work. The Certificate and keys, in the
examples, are provided using the <a href="ssl.html#t:cert_key_conf/0"><code class="inline">ssl:cert_key_conf/0</code></a> supplied in the <code class="inline">certs_keys</code>
introduced in OTP 25.</p></blockquote><h2 id="basic-client" class="section-heading">
  <a href="#basic-client" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Basic Client</span>
</h2>
<pre><code class="makeup erlang" translate="no"><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="1168517878-1">(</span><span class="p" data-group-id="1168517878-1">)</span><span class="p">,</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="1168517878-2">(</span><span class="s">&quot;google.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">443</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1168517878-3">[</span><span class="p" data-group-id="1168517878-4">{</span><span class="ss">verify</span><span class="p">,</span><span class="w"> </span><span class="ss">verify_peer</span><span class="p" data-group-id="1168517878-4">}</span><span class="p">,</span><span class="w">
                                                 </span><span class="p" data-group-id="1168517878-5">{</span><span class="ss">cacerts</span><span class="p">,</span><span class="w"> </span><span class="nc">public_key</span><span class="p">:</span><span class="nf">cacerts_get</span><span class="p" data-group-id="1168517878-6">(</span><span class="p" data-group-id="1168517878-6">)</span><span class="p" data-group-id="1168517878-5">}</span><span class="p" data-group-id="1168517878-3">]</span><span class="p" data-group-id="1168517878-2">)</span><span class="p">.</span><span class="w">
   </span><span class="p" data-group-id="1168517878-7">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="1168517878-8">{</span><span class="ss">sslsocket</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1168517878-9">[</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="1168517878-9">]</span><span class="p" data-group-id="1168517878-8">}</span><span class="p" data-group-id="1168517878-7">}</span></code></pre><h2 id="basic-connection" class="section-heading">
  <a href="#basic-connection" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Basic Connection</span>
</h2>
<p><em>Step 1:</em> Start the server side:</p><pre><code class="makeup erlang" translate="no"><span class="mi">1</span><span class="w"> </span><span class="ss">server</span><span class="o">&gt;</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="2662390035-1">(</span><span class="p" data-group-id="2662390035-1">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span></code></pre><p><em>Step 2:</em> with alternative certificates, in this example the EDDSA certificate
will be preferred if TLS-1.3 is negotiated and the RSA certificate will always
be used for TLS-1.2 as it does not support the EDDSA algorithm:</p><pre><code class="makeup erlang" translate="no"><span class="mi">2</span><span class="w"> </span><span class="ss">server</span><span class="o">&gt;</span><span class="w"> </span><span class="p" data-group-id="6330624764-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ListenSocket</span><span class="p" data-group-id="6330624764-1">}</span><span class="w"> </span><span class="o">=</span><span class="w">
</span><span class="nc">ssl</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="6330624764-2">(</span><span class="mi">9999</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6330624764-3">[</span><span class="p" data-group-id="6330624764-4">{</span><span class="ss">certs_keys</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6330624764-5">[</span><span class="p" data-group-id="6330624764-6">#{</span><span class="ss">certfile</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;eddsacert.pem&quot;</span><span class="p">,</span><span class="w">
                                  </span><span class="ss">keyfile</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;eddsakey.pem&quot;</span><span class="p" data-group-id="6330624764-6">}</span><span class="p">,</span><span class="w">
                                </span><span class="p" data-group-id="6330624764-7">#{</span><span class="ss">certfile</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;rsacert.pem&quot;</span><span class="p">,</span><span class="w">
                                  </span><span class="ss">keyfile</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;rsakey.pem&quot;</span><span class="p">,</span><span class="w">
                                  </span><span class="ss">password</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;foobar&quot;</span><span class="p" data-group-id="6330624764-7">}</span><span class="w">
                               </span><span class="p" data-group-id="6330624764-5">]</span><span class="p" data-group-id="6330624764-4">}</span><span class="p">,</span><span class="p" data-group-id="6330624764-8">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="6330624764-8">}</span><span class="p" data-group-id="6330624764-3">]</span><span class="p" data-group-id="6330624764-2">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="6330624764-9">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="6330624764-10">{</span><span class="ss">sslsocket</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6330624764-11">[</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="6330624764-11">]</span><span class="p" data-group-id="6330624764-10">}</span><span class="p" data-group-id="6330624764-9">}</span></code></pre><p><em>Step 3:</em> Do a transport accept on the TLS listen socket:</p><pre><code class="makeup erlang" translate="no"><span class="mi">3</span><span class="w"> </span><span class="ss">server</span><span class="o">&gt;</span><span class="w"> </span><span class="p" data-group-id="9144163074-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">TLSTransportSocket</span><span class="p" data-group-id="9144163074-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">transport_accept</span><span class="p" data-group-id="9144163074-2">(</span><span class="n">ListenSocket</span><span class="p" data-group-id="9144163074-2">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="9144163074-3">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="9144163074-4">{</span><span class="ss">sslsocket</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9144163074-5">[</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="9144163074-5">]</span><span class="p" data-group-id="9144163074-4">}</span><span class="p" data-group-id="9144163074-3">}</span></code></pre><blockquote><h4 class="info">Note</h4><p>ssl:transport_accept/1 and ssl:handshake/2 are separate functions so that the
handshake part can be called in a new erlang process dedicated to handling the
connection</p></blockquote><p><em>Step 4:</em> Start the client side:</p><pre><code class="makeup erlang" translate="no"><span class="mi">1</span><span class="w"> </span><span class="ss">client</span><span class="o">&gt;</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="1407283961-1">(</span><span class="p" data-group-id="1407283961-1">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span></code></pre><p>Be sure to configure trusted certificates to use for server certificate
verification.</p><pre><code class="makeup erlang" translate="no"><span class="mi">2</span><span class="w"> </span><span class="ss">client</span><span class="o">&gt;</span><span class="w"> </span><span class="p" data-group-id="4068960604-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4068960604-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="4068960604-2">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">9999</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="4068960604-3">[</span><span class="p" data-group-id="4068960604-4">{</span><span class="ss">verify</span><span class="p">,</span><span class="w"> </span><span class="ss">verify_peer</span><span class="p" data-group-id="4068960604-4">}</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="4068960604-5">{</span><span class="ss">cacertfile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cacerts.pem&quot;</span><span class="p" data-group-id="4068960604-5">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4068960604-6">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">once</span><span class="p" data-group-id="4068960604-6">}</span><span class="p" data-group-id="4068960604-3">]</span><span class="p">,</span><span class="w"> </span><span class="ss">infinity</span><span class="p" data-group-id="4068960604-2">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="4068960604-7">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="4068960604-8">{</span><span class="ss">sslsocket</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4068960604-9">[</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="4068960604-9">]</span><span class="p" data-group-id="4068960604-8">}</span><span class="p" data-group-id="4068960604-7">}</span></code></pre><p><em>Step 5:</em> Do the TLS handshake:</p><pre><code class="makeup erlang" translate="no"><span class="mi">4</span><span class="w"> </span><span class="ss">server</span><span class="o">&gt;</span><span class="w"> </span><span class="p" data-group-id="6202749897-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6202749897-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">handshake</span><span class="p" data-group-id="6202749897-2">(</span><span class="n">TLSTransportSocket</span><span class="p" data-group-id="6202749897-2">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="6202749897-3">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="6202749897-4">{</span><span class="ss">sslsocket</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6202749897-5">[</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="6202749897-5">]</span><span class="p" data-group-id="6202749897-4">}</span><span class="p" data-group-id="6202749897-3">}</span></code></pre><blockquote><h4 class="info">Note</h4><p>A real server should use ssl:handshake/2 that has a timeout to avoid DoS
attacks. In the example the timeout defaults to infinty.</p></blockquote><p><em>Step 6:</em> Send a message over TLS:</p><pre><code class="makeup erlang" translate="no"><span class="mi">5</span><span class="w"> </span><span class="ss">server</span><span class="o">&gt;</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="9131110263-1">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p" data-group-id="9131110263-1">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span></code></pre><p><em>Step 7:</em> Flush the shell message queue to see that the message sent on the
server side is recived by the client side:</p><pre><code class="makeup erlang" translate="no"><span class="mi">3</span><span class="w"> </span><span class="ss">client</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">flush</span><span class="p" data-group-id="1246188161-1">(</span><span class="p" data-group-id="1246188161-1">)</span><span class="p">.</span><span class="w">
</span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="1246188161-2">{</span><span class="ss">ssl</span><span class="p">,</span><span class="p" data-group-id="1246188161-3">{</span><span class="ss">sslsocket</span><span class="p">,</span><span class="p" data-group-id="1246188161-4">[</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="1246188161-4">]</span><span class="p" data-group-id="1246188161-3">}</span><span class="p">,</span><span class="s">&quot;foo&quot;</span><span class="p" data-group-id="1246188161-2">}</span><span class="w">
</span><span class="ss">ok</span></code></pre><h2 id="upgrade-example-tls-only" class="section-heading">
  <a href="#upgrade-example-tls-only" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Upgrade Example - TLS only</span>
</h2>
<p>Upgrading a a TCP/IP connection to a TLS connections is mostly used when there
is a desire have unencrypted communication first and then later secure the
communication channel by using TLS. Note that the client and server need to
agree to do the upgrade in the protocol doing the communication. This is concept
is often referenced as <code class="inline">STARTLS</code> and used in many protocols such as <code class="inline">SMTP</code>,
<code class="inline">FTPS</code> and <code class="inline">HTTPS</code> via a proxy.</p><blockquote><h4 class="warning">Warning</h4><p>Maximum security recommendations are however moving away from such solutions.</p></blockquote><p>To upgrade to a TLS connection:</p><p><em>Step 1:</em> Start the server side:</p><pre><code class="makeup erlang" translate="no"><span class="mi">1</span><span class="w"> </span><span class="ss">server</span><span class="o">&gt;</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="8293936621-1">(</span><span class="p" data-group-id="8293936621-1">)</span><span class="p">.</span><span class="w">
  </span><span class="ss">ok</span></code></pre><p><em>Step 2:</em> Create a normal TCP listen socket and ensure <code class="inline">active</code> is set to
<code class="inline">false</code> and not set to any active mode otherwise TLS handshake messages can be
delivered to the wrong process.</p><pre><code class="makeup erlang" translate="no"><span class="mi">2</span><span class="w"> </span><span class="ss">server</span><span class="o">&gt;</span><span class="w"> </span><span class="p" data-group-id="9976745357-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ListenSocket</span><span class="p" data-group-id="9976745357-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="9976745357-2">(</span><span class="mi">9999</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9976745357-3">[</span><span class="p" data-group-id="9976745357-4">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="9976745357-4">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="9976745357-5">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="9976745357-5">}</span><span class="p" data-group-id="9976745357-3">]</span><span class="p" data-group-id="9976745357-2">)</span><span class="p">.</span><span class="w">
  </span><span class="p" data-group-id="9976745357-6">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p">#</span><span class="n">Port</span><span class="o">&lt;</span><span class="mf">0.475</span><span class="o">&gt;</span><span class="p" data-group-id="9976745357-6">}</span></code></pre><p><em>Step 3:</em> Accept client connection:</p><pre><code class="makeup erlang" translate="no"><span class="mi">3</span><span class="w"> </span><span class="ss">server</span><span class="o">&gt;</span><span class="w"> </span><span class="p" data-group-id="6799504132-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="6799504132-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">accept</span><span class="p" data-group-id="6799504132-2">(</span><span class="n">ListenSocket</span><span class="p" data-group-id="6799504132-2">)</span><span class="p">.</span><span class="w">
  </span><span class="p" data-group-id="6799504132-3">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p">#</span><span class="n">Port</span><span class="o">&lt;</span><span class="mf">0.476</span><span class="o">&gt;</span><span class="p" data-group-id="6799504132-3">}</span></code></pre><p><em>Step 4:</em> Start the client side:</p><pre><code class="makeup erlang" translate="no"><span class="mi">1</span><span class="w"> </span><span class="ss">client</span><span class="o">&gt;</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="2113959277-1">(</span><span class="p" data-group-id="2113959277-1">)</span><span class="p">.</span><span class="w">
  </span><span class="ss">ok</span></code></pre><pre><code class="makeup erlang" translate="no"><span class="mi">2</span><span class="w"> </span><span class="ss">client</span><span class="o">&gt;</span><span class="w"> </span><span class="p" data-group-id="8049967627-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="8049967627-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">gen_tcp</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="8049967627-2">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">9999</span><span class="p">,</span><span class="w">  </span><span class="p" data-group-id="8049967627-3">[</span><span class="p" data-group-id="8049967627-3">]</span><span class="p">,</span><span class="w"> </span><span class="ss">infinity</span><span class="p" data-group-id="8049967627-2">)</span><span class="p">.</span></code></pre><p><em>Step 5:</em> Do the TLS handshake:</p><pre><code class="makeup erlang" translate="no"><span class="mi">4</span><span class="w"> </span><span class="ss">server</span><span class="o">&gt;</span><span class="w"> </span><span class="p" data-group-id="8013506707-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">TLSSocket</span><span class="p" data-group-id="8013506707-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">handshake</span><span class="p" data-group-id="8013506707-2">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8013506707-3">[</span><span class="p" data-group-id="8013506707-4">{</span><span class="ss">verify</span><span class="p">,</span><span class="w"> </span><span class="ss">verify_peer</span><span class="p" data-group-id="8013506707-4">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="8013506707-5">{</span><span class="ss">fail_if_no_peer_cert</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="8013506707-5">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="8013506707-6">{</span><span class="ss">cacertfile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cacerts.pem&quot;</span><span class="p" data-group-id="8013506707-6">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="8013506707-7">{</span><span class="ss">certs_keys</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8013506707-8">[</span><span class="p" data-group-id="8013506707-9">#{</span><span class="ss">certfile</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;cert.pem&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">keyfile</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;key.pem&quot;</span><span class="p" data-group-id="8013506707-9">}</span><span class="p" data-group-id="8013506707-8">]</span><span class="p" data-group-id="8013506707-7">}</span><span class="p" data-group-id="8013506707-3">]</span><span class="p" data-group-id="8013506707-2">)</span><span class="p">.</span><span class="w">
  </span><span class="p" data-group-id="8013506707-10">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="8013506707-11">{</span><span class="ss">sslsocket</span><span class="p">,</span><span class="p" data-group-id="8013506707-12">[</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="8013506707-12">]</span><span class="p" data-group-id="8013506707-11">}</span><span class="p" data-group-id="8013506707-10">}</span></code></pre><p><em>Step 6:</em> Upgrade to a TLS connection. The client and server must agree upon the
upgrade. The server must be prepared to be a TLS server before the client can do
a successful connect.</p><pre><code class="makeup erlang" translate="no"><span class="mi">3</span><span class="w"> </span><span class="ss">client</span><span class="o">&gt;</span><span class="p" data-group-id="9950150522-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">TLSSocket</span><span class="p" data-group-id="9950150522-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="9950150522-2">(</span><span class="n">Socket</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9950150522-3">[</span><span class="p" data-group-id="9950150522-4">{</span><span class="ss">verify</span><span class="p">,</span><span class="w"> </span><span class="ss">verify_peer</span><span class="p" data-group-id="9950150522-4">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="9950150522-5">{</span><span class="ss">cacertfile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cacerts.pem&quot;</span><span class="p" data-group-id="9950150522-5">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="9950150522-6">{</span><span class="ss">certs_keys</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9950150522-7">[</span><span class="p" data-group-id="9950150522-8">#{</span><span class="ss">certfile</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;cert.pem&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">keyfile</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;key.pem&quot;</span><span class="p" data-group-id="9950150522-8">}</span><span class="p" data-group-id="9950150522-7">]</span><span class="p" data-group-id="9950150522-6">}</span><span class="p" data-group-id="9950150522-3">]</span><span class="p">,</span><span class="w"> </span><span class="ss">infinity</span><span class="p" data-group-id="9950150522-2">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="9950150522-9">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="9950150522-10">{</span><span class="ss">sslsocket</span><span class="p">,</span><span class="p" data-group-id="9950150522-11">[</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="9950150522-11">]</span><span class="p" data-group-id="9950150522-10">}</span><span class="p" data-group-id="9950150522-9">}</span></code></pre><p><em>Step 7:</em> Send a message over TLS:</p><pre><code class="makeup erlang" translate="no"><span class="mi">4</span><span class="w"> </span><span class="ss">client</span><span class="o">&gt;</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">send</span><span class="p" data-group-id="2773832247-1">(</span><span class="n">TLSSocket</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p" data-group-id="2773832247-1">)</span><span class="p">.</span><span class="w">
      </span><span class="ss">ok</span></code></pre><p><em>Step 8:</em> Set <code class="inline">active once</code> on the TLS socket:</p><pre><code class="makeup erlang" translate="no"><span class="mi">5</span><span class="w"> </span><span class="ss">server</span><span class="o">&gt;</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">setopts</span><span class="p" data-group-id="2999061017-1">(</span><span class="n">TLSSocket</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2999061017-2">[</span><span class="p" data-group-id="2999061017-3">{</span><span class="ss">active</span><span class="p">,</span><span class="w"> </span><span class="ss">once</span><span class="p" data-group-id="2999061017-3">}</span><span class="p" data-group-id="2999061017-2">]</span><span class="p" data-group-id="2999061017-1">)</span><span class="p">.</span><span class="w">
      </span><span class="ss">ok</span></code></pre><p><em>Step 9:</em> Flush the shell message queue to see that the message sent on the
client side is recived by the server side:</p><pre><code class="makeup erlang" translate="no"><span class="mi">5</span><span class="w"> </span><span class="ss">server</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">flush</span><span class="p" data-group-id="8562431485-1">(</span><span class="p" data-group-id="8562431485-1">)</span><span class="p">.</span><span class="w">
      </span><span class="n">Shell</span><span class="w"> </span><span class="ss">got</span><span class="w"> </span><span class="p" data-group-id="8562431485-2">{</span><span class="ss">ssl</span><span class="p">,</span><span class="p" data-group-id="8562431485-3">{</span><span class="ss">sslsocket</span><span class="p">,</span><span class="p" data-group-id="8562431485-4">[</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="8562431485-4">]</span><span class="p" data-group-id="8562431485-3">}</span><span class="p">,</span><span class="s">&quot;foo&quot;</span><span class="p" data-group-id="8562431485-2">}</span><span class="w">
      </span><span class="ss">ok</span></code></pre><h2 id="customizing-cipher-suites" class="section-heading">
  <a href="#customizing-cipher-suites" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Customizing cipher suites</span>
</h2>
<p>Fetch default cipher suite list for a TLS/DTLS version. Change default to all to
get all possible cipher suites.</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="w"> </span><span class="n">Default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">cipher_suites</span><span class="p" data-group-id="1288680035-1">(</span><span class="ss">default</span><span class="p">,</span><span class="w"> </span><span class="ss">&#39;tlsv1.2&#39;</span><span class="p" data-group-id="1288680035-1">)</span><span class="p">.</span><span class="w">
    </span><span class="p" data-group-id="1288680035-2">[</span><span class="p" data-group-id="1288680035-3">#{</span><span class="ss">cipher</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">aes_256_gcm</span><span class="p">,</span><span class="ss">key_exchange</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">ecdhe_ecdsa</span><span class="p">,</span><span class="w">
    </span><span class="ss">mac</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">aead</span><span class="p">,</span><span class="ss">prf</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">sha384</span><span class="p" data-group-id="1288680035-3">}</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="1288680035-2">]</span></code></pre><p>In OTP 20 it is desirable to remove all cipher suites that uses rsa key exchange
(removed from default in 21)</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">2&gt; </span><span class="n">NoRSA</span><span class="w"> </span><span class="o">=</span><span class="w">
    </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">filter_cipher_suites</span><span class="p" data-group-id="7264158161-1">(</span><span class="n">Default</span><span class="p">,</span><span class="w">
                             </span><span class="p" data-group-id="7264158161-2">[</span><span class="p" data-group-id="7264158161-3">{</span><span class="ss">key_exchange</span><span class="p">,</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="7264158161-4">(</span><span class="ss">rsa</span><span class="p" data-group-id="7264158161-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">false</span><span class="p">;</span><span class="w">
                                                </span><span class="p" data-group-id="7264158161-5">(</span><span class="p">_</span><span class="p" data-group-id="7264158161-5">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">true</span><span class="w">
                                             </span><span class="k">end</span><span class="p" data-group-id="7264158161-3">}</span><span class="p" data-group-id="7264158161-2">]</span><span class="p" data-group-id="7264158161-1">)</span><span class="p">.</span><span class="w">
    </span><span class="p" data-group-id="7264158161-6">[</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="7264158161-6">]</span></code></pre><p>Pick just a few suites</p><pre><code class="makeup erlang" translate="no"><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Suites</span><span class="w"> </span><span class="o">=</span><span class="w">
 </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">filter_cipher_suites</span><span class="p" data-group-id="3043285604-1">(</span><span class="n">Default</span><span class="p">,</span><span class="w">
                             </span><span class="p" data-group-id="3043285604-2">[</span><span class="p" data-group-id="3043285604-3">{</span><span class="ss">key_exchange</span><span class="p">,</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="3043285604-4">(</span><span class="ss">ecdh_ecdsa</span><span class="p" data-group-id="3043285604-4">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">true</span><span class="p">;</span><span class="w">
                                                </span><span class="p" data-group-id="3043285604-5">(</span><span class="p">_</span><span class="p" data-group-id="3043285604-5">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">false</span><span class="w">
                                             </span><span class="k">end</span><span class="p" data-group-id="3043285604-3">}</span><span class="p">,</span><span class="w">
                              </span><span class="p" data-group-id="3043285604-6">{</span><span class="ss">cipher</span><span class="p">,</span><span class="w"> </span><span class="nf">fun</span><span class="p" data-group-id="3043285604-7">(</span><span class="ss">aes_128_cbc</span><span class="p" data-group-id="3043285604-7">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="ss">true</span><span class="p">;</span><span class="w">
                                          </span><span class="p" data-group-id="3043285604-8">(</span><span class="p">_</span><span class="p" data-group-id="3043285604-8">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="ss">false</span><span class="w">
                                       </span><span class="k">end</span><span class="p" data-group-id="3043285604-6">}</span><span class="p" data-group-id="3043285604-2">]</span><span class="p" data-group-id="3043285604-1">)</span><span class="p">.</span><span class="w">

</span><span class="p" data-group-id="3043285604-9">[</span><span class="p" data-group-id="3043285604-10">#{</span><span class="ss">cipher</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">aes_128_cbc</span><span class="p">,</span><span class="ss">key_exchange</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">ecdh_ecdsa</span><span class="p">,</span><span class="w">
   </span><span class="ss">mac</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">sha256</span><span class="p">,</span><span class="ss">prf</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">sha256</span><span class="p" data-group-id="3043285604-10">}</span><span class="p">,</span><span class="w">
 </span><span class="p" data-group-id="3043285604-11">#{</span><span class="ss">cipher</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">aes_128_cbc</span><span class="p">,</span><span class="ss">key_exchange</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">ecdh_ecdsa</span><span class="p">,</span><span class="ss">mac</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">sha</span><span class="p">,</span><span class="w">
   </span><span class="ss">prf</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">default_prf</span><span class="p" data-group-id="3043285604-11">}</span><span class="p" data-group-id="3043285604-9">]</span></code></pre><p>Make some particular suites the most preferred, or least preferred by changing
prepend to append.</p><pre><code class="makeup erlang" translate="no"><span class="w"> </span><span class="mi">4</span><span class="o">&gt;</span><span class="nc">ssl</span><span class="p">:</span><span class="nf">prepend_cipher_suites</span><span class="p" data-group-id="2670720131-1">(</span><span class="n">Suites</span><span class="p">,</span><span class="w"> </span><span class="n">Default</span><span class="p" data-group-id="2670720131-1">)</span><span class="p">.</span><span class="w">
  </span><span class="p" data-group-id="2670720131-2">[</span><span class="p" data-group-id="2670720131-3">#{</span><span class="ss">cipher</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">aes_128_cbc</span><span class="p">,</span><span class="ss">key_exchange</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">ecdh_ecdsa</span><span class="p">,</span><span class="w">
     </span><span class="ss">mac</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">sha256</span><span class="p">,</span><span class="ss">prf</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">sha256</span><span class="p" data-group-id="2670720131-3">}</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="2670720131-4">#{</span><span class="ss">cipher</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">aes_128_cbc</span><span class="p">,</span><span class="ss">key_exchange</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">ecdh_ecdsa</span><span class="p">,</span><span class="ss">mac</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">sha</span><span class="p">,</span><span class="w">
     </span><span class="ss">prf</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">default_prf</span><span class="p" data-group-id="2670720131-4">}</span><span class="p">,</span><span class="w">
   </span><span class="p" data-group-id="2670720131-5">#{</span><span class="ss">cipher</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">aes_256_cbc</span><span class="p">,</span><span class="ss">key_exchange</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">ecdhe_ecdsa</span><span class="p">,</span><span class="w">
     </span><span class="ss">mac</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">sha384</span><span class="p">,</span><span class="ss">prf</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">sha384</span><span class="p" data-group-id="2670720131-5">}</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="2670720131-2">]</span></code></pre><h2 id="customizing-signature-algorithms-tls-1-2-schemes-tls-1-3" class="section-heading">
  <a href="#customizing-signature-algorithms-tls-1-2-schemes-tls-1-3" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Customizing signature algorithms(TLS-1.2)/schemes(TLS-1.3)</span>
</h2>
<p>Starting from TLS-1.2 signature algorithms (called signature schemes in TLS-1.3)
is something that can be negotiated and hence also configured. These
algorithms/schemes will be used for digital signatures in protocol messages and
in certificates.</p><blockquote><h4 class="info">Note</h4><p>TLS-1.3 schemes have atom names whereas TLS-1.2 configuration is two element
tuples composed by one hash algorithm and one signature algorithm. When both
versions are supported the configuration can be a mix of these as both
versions might be negotiated. All <code class="inline">rsa_pss</code> based schemes are back ported to
TLS-1.2 and can be used also in a TLS-1.2 configuration. In TLS-1.2 the
signature algorithms chosen by the server will also be affected by the chiper
suite that is chosen, which is not the case in TLS-1.3.</p></blockquote><p>Using the function <a href="ssl.html#signature_algs/2"><code class="inline">ssl:signature_algs/2</code></a> will let you inspect different aspects
of possible configurations for your system. For example if TLS-1.3 and TLS-1.2
is supported the default signature_algorithm list in OTP-26 and cryptolib from
OpenSSL 3.0.2 would look like:</p><pre><code class="makeup erlang" translate="no"><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="w">  </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">signature_algs</span><span class="p" data-group-id="5023540061-1">(</span><span class="ss">default</span><span class="p">,</span><span class="w"> </span><span class="ss">&#39;tlsv1.3&#39;</span><span class="p" data-group-id="5023540061-1">)</span><span class="p">.</span><span class="w">
 </span><span class="c1">%% TLS-1.3 schemes</span><span class="w">
 </span><span class="p" data-group-id="5023540061-2">[</span><span class="ss">eddsa_ed25519</span><span class="p">,</span><span class="ss">eddsa_ed448</span><span class="p">,</span><span class="ss">ecdsa_secp521r1_sha512</span><span class="p">,</span><span class="w">
  </span><span class="ss">ecdsa_secp384r1_sha384</span><span class="p">,</span><span class="ss">ecdsa_secp256r1_sha256</span><span class="p">,</span><span class="w">
  </span><span class="ss">rsa_pss_pss_sha512</span><span class="p">,</span><span class="ss">rsa_pss_pss_sha384</span><span class="p">,</span><span class="ss">rsa_pss_pss_sha256</span><span class="p">,</span><span class="w">
  </span><span class="ss">rsa_pss_rsae_sha512</span><span class="p">,</span><span class="ss">rsa_pss_rsae_sha384</span><span class="p">,</span><span class="ss">rsa_pss_rsae_sha256</span><span class="p">,</span><span class="w">
  </span><span class="c1">%% Legacy schemes only valid for certificate signatures in TLS-1.3</span><span class="w">
  </span><span class="c1">%% (would have a tuple name in TLS-1.2 only configuration)</span><span class="w">
  </span><span class="ss">rsa_pkcs1_sha512</span><span class="p">,</span><span class="ss">rsa_pkcs1_sha384</span><span class="p">,</span><span class="ss">rsa_pkcs1_sha256</span><span class="w">
  </span><span class="c1">%% TLS 1.2 algorithms</span><span class="w">
  </span><span class="p" data-group-id="5023540061-3">{</span><span class="ss">sha512</span><span class="p">,</span><span class="ss">ecdsa</span><span class="p" data-group-id="5023540061-3">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="5023540061-4">{</span><span class="ss">sha384</span><span class="p">,</span><span class="ss">ecdsa</span><span class="p" data-group-id="5023540061-4">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="5023540061-5">{</span><span class="ss">sha256</span><span class="p">,</span><span class="ss">ecdsa</span><span class="p" data-group-id="5023540061-5">}</span><span class="p" data-group-id="5023540061-2">]</span></code></pre><p>If you want to add support for non default supported algorithms you should
append them to the default list as the configuration is in prefered order,
something like this:</p><pre><code class="makeup erlang" translate="no"><span class="w">    </span><span class="n">MySignatureAlgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">signature_algs</span><span class="p" data-group-id="9062626758-1">(</span><span class="ss">default</span><span class="p">,</span><span class="w"> </span><span class="ss">&#39;tlsv1.3&#39;</span><span class="p" data-group-id="9062626758-1">)</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="p" data-group-id="9062626758-2">[</span><span class="p" data-group-id="9062626758-3">{</span><span class="ss">sha</span><span class="p">,</span><span class="w"> </span><span class="ss">rsa</span><span class="p" data-group-id="9062626758-3">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9062626758-4">{</span><span class="ss">sha</span><span class="p">,</span><span class="w"> </span><span class="ss">dsa</span><span class="p" data-group-id="9062626758-4">}</span><span class="p" data-group-id="9062626758-2">]</span><span class="p">,</span><span class="w">
    </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="9062626758-5">(</span><span class="n">Host</span><span class="p">,</span><span class="n">Port</span><span class="p">,</span><span class="p" data-group-id="9062626758-6">[</span><span class="p" data-group-id="9062626758-7">{</span><span class="ss">signature_algs</span><span class="p">,</span><span class="w"> </span><span class="n">MySignatureAlgs</span><span class="p">,</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">]</span><span class="p" data-group-id="9062626758-7">}</span><span class="p">)</span><span class="p">,</span><span class="w">
    </span><span class="p">.</span><span class="p">.</span><span class="p">.</span></code></pre><p>See also <a href="ssl.html#signature_algs/2"><code class="inline">ssl:signature_algs/2</code></a> and <a href="ssl.html#t:signature_algs/0">sign_algo()</a></p><h2 id="using-an-engine-stored-key" class="section-heading">
  <a href="#using-an-engine-stored-key" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Using an Engine Stored Key</span>
</h2>
<p>Erlang ssl application is able to use private keys provided by OpenSSL engines
using the following mechanism:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="3743104816-1">(</span><span class="p" data-group-id="3743104816-1">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span></code></pre><p>Load a crypto engine, should be done once per engine used. For example
dynamically load the engine called <code class="inline">MyEngine</code>:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">2&gt; </span><span class="p" data-group-id="1708611151-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">EngineRef</span><span class="p" data-group-id="1708611151-1">}</span><span class="w"> </span><span class="o">=</span><span class="w">
</span><span class="nc">crypto</span><span class="p">:</span><span class="nf">engine_load</span><span class="p" data-group-id="1708611151-2">(</span><span class="p">&lt;&lt;</span><span class="s">&quot;dynamic&quot;</span><span class="p">&gt;&gt;</span><span class="p">,</span><span class="w">
</span><span class="p" data-group-id="1708611151-3">[</span><span class="p" data-group-id="1708611151-4">{</span><span class="p">&lt;&lt;</span><span class="s">&quot;SO_PATH&quot;</span><span class="p">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/tmp/user/engines/MyEngine&quot;</span><span class="p" data-group-id="1708611151-4">}</span><span class="p">,</span><span class="p">&lt;&lt;</span><span class="s">&quot;LOAD&quot;</span><span class="p">&gt;&gt;</span><span class="p" data-group-id="1708611151-3">]</span><span class="p">,</span><span class="w">
</span><span class="p" data-group-id="1708611151-5">[</span><span class="p" data-group-id="1708611151-5">]</span><span class="p" data-group-id="1708611151-2">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="1708611151-6">{</span><span class="ss">ok</span><span class="p">,</span><span class="p">#</span><span class="n">Ref</span><span class="o">&lt;</span><span class="mf">0.2399045421</span><span class="p">.</span><span class="mf">3028942852.173962</span><span class="o">&gt;</span><span class="p" data-group-id="1708611151-6">}</span></code></pre><p>Create a map with the engine information and the algorithm used by the engine:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">3&gt; </span><span class="n">PrivKey</span><span class="w"> </span><span class="o">=</span><span class="w">
 </span><span class="p" data-group-id="9098291555-1">#{</span><span class="ss">algorithm</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ss">rsa</span><span class="p">,</span><span class="w">
   </span><span class="ss">engine</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="n">EngineRef</span><span class="p">,</span><span class="w">
   </span><span class="ss">key_id</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;id of the private key in Engine&quot;</span><span class="p" data-group-id="9098291555-1">}</span><span class="p">.</span></code></pre><p>Use the map in the ssl key option:</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">4&gt; </span><span class="p" data-group-id="5464038474-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">SSLSocket</span><span class="p" data-group-id="5464038474-1">}</span><span class="w"> </span><span class="o">=</span><span class="w">
 </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="5464038474-2">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">9999</span><span class="p">,</span><span class="w">
                </span><span class="p" data-group-id="5464038474-3">[</span><span class="p" data-group-id="5464038474-4">{</span><span class="ss">cacertfile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cacerts.pem&quot;</span><span class="p" data-group-id="5464038474-4">}</span><span class="p">,</span><span class="w">
                 </span><span class="p" data-group-id="5464038474-5">{</span><span class="ss">certs_keys</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5464038474-6">[</span><span class="p" data-group-id="5464038474-7">#{</span><span class="ss">certfile</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;cert.pem&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">key</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="n">PrivKey</span><span class="p" data-group-id="5464038474-7">}</span><span class="p" data-group-id="5464038474-6">]</span><span class="p" data-group-id="5464038474-5">}</span><span class="w">
                </span><span class="p" data-group-id="5464038474-3">]</span><span class="p">,</span><span class="w"> </span><span class="ss">infinity</span><span class="p" data-group-id="5464038474-2">)</span><span class="p">.</span><span class="w">
</span></code></pre><p>See also <a href="../../apps/crypto/engine_load.html#engine_load">crypto documentation</a></p><h2 id="nss-keylog" class="section-heading">
  <a href="#nss-keylog" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">NSS keylog</span>
</h2>
<p>The NSS keylog debug feature can be used by authorized users to for instance
enable wireshark to decrypt TLS packets.</p><p><em>Server (with NSS key logging)</em></p><pre><code class="makeup erlang" translate="no"><span class="w">    </span><span class="nf">server</span><span class="p" data-group-id="6670907715-1">(</span><span class="p" data-group-id="6670907715-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
        </span><span class="nc">application</span><span class="p">:</span><span class="nf">load</span><span class="p" data-group-id="6670907715-2">(</span><span class="ss">ssl</span><span class="p" data-group-id="6670907715-2">)</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6670907715-3">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="p" data-group-id="6670907715-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">application</span><span class="p">:</span><span class="nf">ensure_all_started</span><span class="p" data-group-id="6670907715-4">(</span><span class="ss">ssl</span><span class="p" data-group-id="6670907715-4">)</span><span class="p">,</span><span class="w">
        </span><span class="n">Port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11029</span><span class="p">,</span><span class="w">
        </span><span class="n">LOpts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6670907715-5">[</span><span class="p" data-group-id="6670907715-6">{</span><span class="ss">certs_keys</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6670907715-7">[</span><span class="p" data-group-id="6670907715-8">#{</span><span class="ss">certfile</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;cert.pem&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">keyfile</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;key.pem&quot;</span><span class="p" data-group-id="6670907715-8">}</span><span class="p" data-group-id="6670907715-7">]</span><span class="p" data-group-id="6670907715-6">}</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6670907715-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="6670907715-9">}</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6670907715-10">{</span><span class="ss">versions</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6670907715-11">[</span><span class="ss">&#39;tlsv1.2&#39;</span><span class="p">,</span><span class="ss">&#39;tlsv1.3&#39;</span><span class="p" data-group-id="6670907715-11">]</span><span class="p" data-group-id="6670907715-10">}</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6670907715-12">{</span><span class="ss">keep_secrets</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="6670907715-12">}</span><span class="w"> </span><span class="c1">%% Enable NSS key log (debug option)</span><span class="w">
        </span><span class="p" data-group-id="6670907715-5">]</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6670907715-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSock</span><span class="p" data-group-id="6670907715-13">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="6670907715-14">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="n">LOpts</span><span class="p" data-group-id="6670907715-14">)</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6670907715-15">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ASock</span><span class="p" data-group-id="6670907715-15">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">transport_accept</span><span class="p" data-group-id="6670907715-16">(</span><span class="n">LSock</span><span class="p" data-group-id="6670907715-16">)</span><span class="p">,</span><span class="w">
        </span><span class="p" data-group-id="6670907715-17">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">CSock</span><span class="p" data-group-id="6670907715-17">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">handshake</span><span class="p" data-group-id="6670907715-18">(</span><span class="n">ASock</span><span class="p" data-group-id="6670907715-18">)</span><span class="p">.</span></code></pre><p><em>Exporting the secrets</em></p><pre><code class="makeup erlang" translate="no"><span class="w">      </span><span class="p" data-group-id="5923076954-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5923076954-2">[</span><span class="p" data-group-id="5923076954-3">{</span><span class="ss">keylog</span><span class="p">,</span><span class="w"> </span><span class="n">KeylogItems</span><span class="p" data-group-id="5923076954-3">}</span><span class="p" data-group-id="5923076954-2">]</span><span class="p" data-group-id="5923076954-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connection_information</span><span class="p" data-group-id="5923076954-4">(</span><span class="n">CSock</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5923076954-5">[</span><span class="ss">keylog</span><span class="p" data-group-id="5923076954-5">]</span><span class="p" data-group-id="5923076954-4">)</span><span class="p">.</span><span class="w">
      </span><span class="nc">file</span><span class="p">:</span><span class="nf">write_file</span><span class="p" data-group-id="5923076954-6">(</span><span class="s">&quot;key.log&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5923076954-7">[</span><span class="p" data-group-id="5923076954-8">[</span><span class="n">KeylogItem</span><span class="p">,</span><span class="sc">$\n</span><span class="p" data-group-id="5923076954-8">]</span><span class="w"> </span><span class="p">||</span><span class="w"> </span><span class="n">KeylogItem</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">KeylogItems</span><span class="p" data-group-id="5923076954-7">]</span><span class="p" data-group-id="5923076954-6">)</span><span class="p">.</span></code></pre><h2 id="session-reuse-prior-to-tls-1-3" class="section-heading">
  <a href="#session-reuse-prior-to-tls-1-3" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Session Reuse Prior to TLS 1.3</span>
</h2>
<p>Clients can request to reuse a session established by a previous full handshake
between that client and server by sending the id of the session in the initial
handshake message. The server may or may not agree to reuse it. If agreed the
server will send back the id and if not it will send a new id. The ssl
application has several options for handling session reuse.</p><p>On the client side the ssl application will save session data to try to automate
session reuse on behalf of the client processes on the Erlang node. Note that
only verified sessions will be saved for security reasons, that is session
resumption relies on the certificate validation to have been run in the original
handshake. To minimize memory consumption only unique sessions will be saved
unless the special <code class="inline">save</code> value is specified for the following option
<code class="inline">{reuse_sessions, boolean() | save}</code> in which case a full handshake will be
performed and that specific session will have been saved before the handshake
returns. The session id and even an opaque binary containing the session data
can be retrieved using <a href="ssl.html#connection_information/1"><code class="inline">ssl:connection_information/1</code></a> function. A saved session
(guaranteed by the save option) can be explicitly reused using
<code class="inline">{reuse_session, SessionId}</code>. Also it is possible for the client to reuse a
session that is not saved by the ssl application using
<code class="inline">{reuse_session, {SessionId, SessionData}}</code>.</p><blockquote><h4 class="info">Note</h4><p>When using explicit session reuse, it is up to the client to make sure that
the session being reused is for the correct server and has been verified.</p></blockquote><p>Here follows a client side example, divide into several steps for readability.</p><p>Step 1 - Automated Session Reuse</p><pre><code class="makeup erlang" translate="no"><span class="gp unselectable">1&gt; </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">start</span><span class="p" data-group-id="3226435912-1">(</span><span class="p" data-group-id="3226435912-1">)</span><span class="p">.</span><span class="w">
</span><span class="ss">ok</span><span class="w">

</span><span class="mi">2</span><span class="o">&gt;</span><span class="p" data-group-id="3226435912-2">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">C1</span><span class="p" data-group-id="3226435912-2">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="3226435912-3">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">9999</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3226435912-4">[</span><span class="p" data-group-id="3226435912-5">{</span><span class="ss">verify</span><span class="p">,</span><span class="w"> </span><span class="ss">verify_peer</span><span class="p" data-group-id="3226435912-5">}</span><span class="p">,</span><span class="w">
                                           </span><span class="p" data-group-id="3226435912-6">{</span><span class="ss">versions</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3226435912-7">[</span><span class="ss">&#39;tlsv1.2&#39;</span><span class="p" data-group-id="3226435912-7">]</span><span class="p" data-group-id="3226435912-6">}</span><span class="p">,</span><span class="w">
                                           </span><span class="p" data-group-id="3226435912-8">{</span><span class="ss">cacertfile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cacerts.pem&quot;</span><span class="p" data-group-id="3226435912-8">}</span><span class="p" data-group-id="3226435912-4">]</span><span class="p" data-group-id="3226435912-3">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="3226435912-9">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="3226435912-10">{</span><span class="ss">sslsocket</span><span class="p">,</span><span class="p" data-group-id="3226435912-11">{</span><span class="ss">gen_tcp</span><span class="p">,</span><span class="p">#</span><span class="n">Port</span><span class="o">&lt;</span><span class="mf">0.7</span><span class="o">&gt;</span><span class="p">,</span><span class="ss">tls_connection</span><span class="p">,</span><span class="ss">undefined</span><span class="p" data-group-id="3226435912-11">}</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="3226435912-10">}</span><span class="p" data-group-id="3226435912-9">}</span><span class="w">

</span><span class="mi">3</span><span class="o">&gt;</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connection_information</span><span class="p" data-group-id="3226435912-12">(</span><span class="n">C1</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3226435912-13">[</span><span class="ss">session_id</span><span class="p" data-group-id="3226435912-13">]</span><span class="p" data-group-id="3226435912-12">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="3226435912-14">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="3226435912-15">[</span><span class="p" data-group-id="3226435912-16">{</span><span class="ss">session_id</span><span class="p">,</span><span class="p">&lt;&lt;</span><span class="mi">95</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">43</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">35</span><span class="p">,</span><span class="mi">63</span><span class="p">,</span><span class="mi">249</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">106</span><span class="p">,</span><span class="w">
                   </span><span class="mi">152</span><span class="p">,</span><span class="mi">49</span><span class="p">,</span><span class="mi">52</span><span class="p">,</span><span class="mi">124</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">130</span><span class="p">,</span><span class="mi">192</span><span class="p">,</span><span class="mi">137</span><span class="p">,</span><span class="mi">161</span><span class="p">,</span><span class="w">
                   </span><span class="mi">146</span><span class="p">,</span><span class="mi">145</span><span class="p">,</span><span class="mi">164</span><span class="p">,</span><span class="mi">232</span><span class="p">,</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">&gt;&gt;</span><span class="p" data-group-id="3226435912-16">}</span><span class="p" data-group-id="3226435912-15">]</span><span class="p" data-group-id="3226435912-14">}</span><span class="w">

</span><span class="c1">%% Reuse session if possible, note that if C2 is really fast the session</span><span class="w">
</span><span class="c1">%% data might not be available for reuse.</span><span class="w">
</span><span class="mi">4</span><span class="o">&gt;</span><span class="p" data-group-id="3226435912-17">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">C2</span><span class="p" data-group-id="3226435912-17">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="3226435912-18">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">9999</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3226435912-19">[</span><span class="p" data-group-id="3226435912-20">{</span><span class="ss">verify</span><span class="p">,</span><span class="w"> </span><span class="ss">verify_peer</span><span class="p" data-group-id="3226435912-20">}</span><span class="p">,</span><span class="w">
                                           </span><span class="p" data-group-id="3226435912-21">{</span><span class="ss">versions</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3226435912-22">[</span><span class="ss">&#39;tlsv1.2&#39;</span><span class="p" data-group-id="3226435912-22">]</span><span class="p" data-group-id="3226435912-21">}</span><span class="p">,</span><span class="w">
                                           </span><span class="p" data-group-id="3226435912-23">{</span><span class="ss">cacertfile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cacerts.pem&quot;</span><span class="p" data-group-id="3226435912-23">}</span><span class="p">,</span><span class="w">
                                           </span><span class="p" data-group-id="3226435912-24">{</span><span class="ss">reuse_sessions</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="3226435912-24">}</span><span class="p" data-group-id="3226435912-19">]</span><span class="p" data-group-id="3226435912-18">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="3226435912-25">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="3226435912-26">{</span><span class="ss">sslsocket</span><span class="p">,</span><span class="p" data-group-id="3226435912-27">{</span><span class="ss">gen_tcp</span><span class="p">,</span><span class="p">#</span><span class="n">Port</span><span class="o">&lt;</span><span class="mf">0.8</span><span class="o">&gt;</span><span class="p">,</span><span class="ss">tls_connection</span><span class="p">,</span><span class="ss">undefined</span><span class="p" data-group-id="3226435912-27">}</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">]</span><span class="p" data-group-id="3226435912-26">}</span><span class="p" data-group-id="3226435912-25">}</span><span class="w">

</span><span class="c1">%% C2 got same session ID as client one, session was automatically reused.</span><span class="gp unselectable">
5&gt; </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connection_information</span><span class="p" data-group-id="3226435912-28">(</span><span class="n">C2</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3226435912-29">[</span><span class="ss">session_id</span><span class="p" data-group-id="3226435912-29">]</span><span class="p" data-group-id="3226435912-28">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="3226435912-30">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="3226435912-31">[</span><span class="p" data-group-id="3226435912-32">{</span><span class="ss">session_id</span><span class="p">,</span><span class="p">&lt;&lt;</span><span class="mi">95</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">43</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">35</span><span class="p">,</span><span class="mi">63</span><span class="p">,</span><span class="mi">249</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">106</span><span class="p">,</span><span class="w">
                   </span><span class="mi">152</span><span class="p">,</span><span class="mi">49</span><span class="p">,</span><span class="mi">52</span><span class="p">,</span><span class="mi">124</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">130</span><span class="p">,</span><span class="mi">192</span><span class="p">,</span><span class="mi">137</span><span class="p">,</span><span class="mi">161</span><span class="p">,</span><span class="w">
                   </span><span class="mi">146</span><span class="p">,</span><span class="mi">145</span><span class="p">,</span><span class="mi">164</span><span class="p">,</span><span class="mi">232</span><span class="p">,</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">&gt;&gt;</span><span class="p" data-group-id="3226435912-32">}</span><span class="p" data-group-id="3226435912-31">]</span><span class="p" data-group-id="3226435912-30">}</span></code></pre><p>Step 2- Using <code class="inline">save</code> Option</p><pre><code class="makeup erlang" translate="no"><span class="c1">%% We want save this particular session for</span><span class="w">
</span><span class="c1">%% reuse although it has the same basis as C1</span><span class="gp unselectable">
6&gt; </span><span class="p" data-group-id="5826860260-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">C3</span><span class="p" data-group-id="5826860260-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="5826860260-2">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">9999</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5826860260-3">[</span><span class="p" data-group-id="5826860260-4">{</span><span class="ss">verify</span><span class="p">,</span><span class="w"> </span><span class="ss">verify_peer</span><span class="p" data-group-id="5826860260-4">}</span><span class="p">,</span><span class="w">
                                           </span><span class="p" data-group-id="5826860260-5">{</span><span class="ss">versions</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5826860260-6">[</span><span class="ss">&#39;tlsv1.2&#39;</span><span class="p" data-group-id="5826860260-6">]</span><span class="p" data-group-id="5826860260-5">}</span><span class="p">,</span><span class="w">
                                           </span><span class="p" data-group-id="5826860260-7">{</span><span class="ss">cacertfile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cacerts.pem&quot;</span><span class="p" data-group-id="5826860260-7">}</span><span class="p">,</span><span class="w">
                                           </span><span class="p" data-group-id="5826860260-8">{</span><span class="ss">reuse_sessions</span><span class="p">,</span><span class="w"> </span><span class="ss">save</span><span class="p" data-group-id="5826860260-8">}</span><span class="p" data-group-id="5826860260-3">]</span><span class="p" data-group-id="5826860260-2">)</span><span class="p">.</span><span class="w">

</span><span class="p" data-group-id="5826860260-9">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="5826860260-10">{</span><span class="ss">sslsocket</span><span class="p">,</span><span class="p" data-group-id="5826860260-11">{</span><span class="ss">gen_tcp</span><span class="p">,</span><span class="p">#</span><span class="n">Port</span><span class="o">&lt;</span><span class="mf">0.9</span><span class="o">&gt;</span><span class="p">,</span><span class="ss">tls_connection</span><span class="p">,</span><span class="ss">undefined</span><span class="p" data-group-id="5826860260-11">}</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">]</span><span class="p" data-group-id="5826860260-10">}</span><span class="p" data-group-id="5826860260-9">}</span><span class="w">

</span><span class="c1">%% A full handshake is performed and we get a new session ID</span><span class="gp unselectable">
7&gt; </span><span class="p" data-group-id="5826860260-12">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5826860260-13">[</span><span class="p" data-group-id="5826860260-14">{</span><span class="ss">session_id</span><span class="p">,</span><span class="w"> </span><span class="n">ID</span><span class="p" data-group-id="5826860260-14">}</span><span class="p" data-group-id="5826860260-13">]</span><span class="p" data-group-id="5826860260-12">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connection_information</span><span class="p" data-group-id="5826860260-15">(</span><span class="n">C3</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5826860260-16">[</span><span class="ss">session_id</span><span class="p" data-group-id="5826860260-16">]</span><span class="p" data-group-id="5826860260-15">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="5826860260-17">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="5826860260-18">[</span><span class="p" data-group-id="5826860260-19">{</span><span class="ss">session_id</span><span class="p">,</span><span class="p">&lt;&lt;</span><span class="mi">91</span><span class="p">,</span><span class="mi">84</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">151</span><span class="p">,</span><span class="mi">183</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">84</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">143</span><span class="p">,</span><span class="mi">141</span><span class="p">,</span><span class="w">
                   </span><span class="mi">121</span><span class="p">,</span><span class="mi">190</span><span class="p">,</span><span class="mi">66</span><span class="p">,</span><span class="mi">192</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">192</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">95</span><span class="p">,</span><span class="mi">78</span><span class="p">,</span><span class="w">
                   </span><span class="mi">8</span><span class="p">,</span><span class="mi">34</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">&gt;&gt;</span><span class="p" data-group-id="5826860260-19">}</span><span class="p" data-group-id="5826860260-18">]</span><span class="p" data-group-id="5826860260-17">}</span><span class="w">

</span><span class="c1">%% Use automatic session reuse</span><span class="gp unselectable">
8&gt; </span><span class="p" data-group-id="5826860260-20">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">C4</span><span class="p" data-group-id="5826860260-20">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="5826860260-21">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">9999</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5826860260-22">[</span><span class="p" data-group-id="5826860260-23">{</span><span class="ss">verify</span><span class="p">,</span><span class="w"> </span><span class="ss">verify_peer</span><span class="p" data-group-id="5826860260-23">}</span><span class="p">,</span><span class="w">
                                           </span><span class="p" data-group-id="5826860260-24">{</span><span class="ss">versions</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5826860260-25">[</span><span class="ss">&#39;tlsv1.2&#39;</span><span class="p" data-group-id="5826860260-25">]</span><span class="p" data-group-id="5826860260-24">}</span><span class="p">,</span><span class="w">
                                           </span><span class="p" data-group-id="5826860260-26">{</span><span class="ss">cacertfile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cacerts.pem&quot;</span><span class="p" data-group-id="5826860260-26">}</span><span class="p">,</span><span class="w">
                                           </span><span class="p" data-group-id="5826860260-27">{</span><span class="ss">reuse_sessions</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="5826860260-27">}</span><span class="p" data-group-id="5826860260-22">]</span><span class="p" data-group-id="5826860260-21">)</span><span class="p">.</span><span class="w">

</span><span class="p" data-group-id="5826860260-28">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="5826860260-29">{</span><span class="ss">sslsocket</span><span class="p">,</span><span class="p" data-group-id="5826860260-30">{</span><span class="ss">gen_tcp</span><span class="p">,</span><span class="p">#</span><span class="n">Port</span><span class="o">&lt;</span><span class="mf">0.10</span><span class="o">&gt;</span><span class="p">,</span><span class="ss">tls_connection</span><span class="p">,</span><span class="w">
                        </span><span class="ss">undefined</span><span class="p" data-group-id="5826860260-30">}</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">]</span><span class="p" data-group-id="5826860260-29">}</span><span class="p" data-group-id="5826860260-28">}</span><span class="w">

</span><span class="c1">%% The &quot;saved&quot; one happened to be selected, but this is not a guarantee</span><span class="gp unselectable">
9&gt; </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connection_information</span><span class="p" data-group-id="5826860260-31">(</span><span class="n">C4</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5826860260-32">[</span><span class="ss">session_id</span><span class="p" data-group-id="5826860260-32">]</span><span class="p" data-group-id="5826860260-31">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="5826860260-33">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="5826860260-34">[</span><span class="p" data-group-id="5826860260-35">{</span><span class="ss">session_id</span><span class="p">,</span><span class="p">&lt;&lt;</span><span class="mi">91</span><span class="p">,</span><span class="mi">84</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">151</span><span class="p">,</span><span class="mi">183</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">84</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">143</span><span class="p">,</span><span class="mi">141</span><span class="p">,</span><span class="w">
                   </span><span class="mi">121</span><span class="p">,</span><span class="mi">190</span><span class="p">,</span><span class="mi">66</span><span class="p">,</span><span class="mi">192</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">192</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">95</span><span class="p">,</span><span class="mi">78</span><span class="p">,</span><span class="w">
                   </span><span class="mi">8</span><span class="p">,</span><span class="mi">34</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">&gt;&gt;</span><span class="p" data-group-id="5826860260-35">}</span><span class="p" data-group-id="5826860260-34">]</span><span class="p" data-group-id="5826860260-33">}</span><span class="w">

</span><span class="c1">%% Make sure to reuse the &quot;saved&quot; session</span><span class="gp unselectable">
10&gt; </span><span class="p" data-group-id="5826860260-36">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">C5</span><span class="p" data-group-id="5826860260-36">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="5826860260-37">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">9999</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5826860260-38">[</span><span class="p" data-group-id="5826860260-39">{</span><span class="ss">verify</span><span class="p">,</span><span class="w"> </span><span class="ss">verify_peer</span><span class="p" data-group-id="5826860260-39">}</span><span class="p">,</span><span class="w">
                                           </span><span class="p" data-group-id="5826860260-40">{</span><span class="ss">versions</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5826860260-41">[</span><span class="ss">&#39;tlsv1.2&#39;</span><span class="p" data-group-id="5826860260-41">]</span><span class="p" data-group-id="5826860260-40">}</span><span class="p">,</span><span class="w">
                                           </span><span class="p" data-group-id="5826860260-42">{</span><span class="ss">cacertfile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cacerts.pem&quot;</span><span class="p" data-group-id="5826860260-42">}</span><span class="p">,</span><span class="w">
                                           </span><span class="p" data-group-id="5826860260-43">{</span><span class="ss">reuse_session</span><span class="p">,</span><span class="w"> </span><span class="n">ID</span><span class="p" data-group-id="5826860260-43">}</span><span class="p" data-group-id="5826860260-38">]</span><span class="p" data-group-id="5826860260-37">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="5826860260-44">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="5826860260-45">{</span><span class="ss">sslsocket</span><span class="p">,</span><span class="p" data-group-id="5826860260-46">{</span><span class="ss">gen_tcp</span><span class="p">,</span><span class="p">#</span><span class="n">Port</span><span class="o">&lt;</span><span class="mf">0.11</span><span class="o">&gt;</span><span class="p">,</span><span class="ss">tls_connection</span><span class="p">,</span><span class="w">
                        </span><span class="ss">undefined</span><span class="p" data-group-id="5826860260-46">}</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">]</span><span class="p" data-group-id="5826860260-45">}</span><span class="p" data-group-id="5826860260-44">}</span><span class="w">

</span><span class="mi">11</span><span class="o">&gt;</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connection_information</span><span class="p" data-group-id="5826860260-47">(</span><span class="n">C5</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5826860260-48">[</span><span class="ss">session_id</span><span class="p" data-group-id="5826860260-48">]</span><span class="p" data-group-id="5826860260-47">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="5826860260-49">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="5826860260-50">[</span><span class="p" data-group-id="5826860260-51">{</span><span class="ss">session_id</span><span class="p">,</span><span class="p">&lt;&lt;</span><span class="mi">91</span><span class="p">,</span><span class="mi">84</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">151</span><span class="p">,</span><span class="mi">183</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">84</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">143</span><span class="p">,</span><span class="mi">141</span><span class="p">,</span><span class="w">
                   </span><span class="mi">121</span><span class="p">,</span><span class="mi">190</span><span class="p">,</span><span class="mi">66</span><span class="p">,</span><span class="mi">192</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">192</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">95</span><span class="p">,</span><span class="mi">78</span><span class="p">,</span><span class="w">
                   </span><span class="mi">8</span><span class="p">,</span><span class="mi">34</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">&gt;&gt;</span><span class="p" data-group-id="5826860260-51">}</span><span class="p" data-group-id="5826860260-50">]</span><span class="p" data-group-id="5826860260-49">}</span></code></pre><p>Step 3 - Explicit Session Reuse</p><pre><code class="makeup erlang" translate="no"><span class="c1">%% Perform a full handshake and the session will not be saved for reuse</span><span class="gp unselectable">
12&gt; </span><span class="p" data-group-id="3374929874-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">C9</span><span class="p" data-group-id="3374929874-1">}</span><span class="w"> </span><span class="o">=</span><span class="w">
</span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="3374929874-2">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">9999</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3374929874-3">[</span><span class="p" data-group-id="3374929874-4">{</span><span class="ss">verify</span><span class="p">,</span><span class="w"> </span><span class="ss">verify_peer</span><span class="p" data-group-id="3374929874-4">}</span><span class="p">,</span><span class="w">
                                    </span><span class="p" data-group-id="3374929874-5">{</span><span class="ss">versions</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3374929874-6">[</span><span class="ss">&#39;tlsv1.2&#39;</span><span class="p" data-group-id="3374929874-6">]</span><span class="p" data-group-id="3374929874-5">}</span><span class="p">,</span><span class="w">
                                    </span><span class="p" data-group-id="3374929874-7">{</span><span class="ss">cacertfile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cacerts.pem&quot;</span><span class="p" data-group-id="3374929874-7">}</span><span class="p">,</span><span class="w">
                                    </span><span class="p" data-group-id="3374929874-8">{</span><span class="ss">reuse_sessions</span><span class="p">,</span><span class="w"> </span><span class="ss">false</span><span class="p" data-group-id="3374929874-8">}</span><span class="p">,</span><span class="w">
                                    </span><span class="p" data-group-id="3374929874-9">{</span><span class="ss">server_name_indication</span><span class="p">,</span><span class="w"> </span><span class="ss">disable</span><span class="p" data-group-id="3374929874-9">}</span><span class="p" data-group-id="3374929874-3">]</span><span class="p" data-group-id="3374929874-2">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="3374929874-10">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="3374929874-11">{</span><span class="ss">sslsocket</span><span class="p">,</span><span class="p" data-group-id="3374929874-12">{</span><span class="ss">gen_tcp</span><span class="p">,</span><span class="p">#</span><span class="n">Port</span><span class="o">&lt;</span><span class="mf">0.14</span><span class="o">&gt;</span><span class="p">,</span><span class="ss">tls_connection</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="3374929874-12">}</span><span class="p" data-group-id="3374929874-11">}</span><span class="w">

</span><span class="c1">%% Fetch session ID and data for C9 connection</span><span class="gp unselectable">
12&gt; </span><span class="p" data-group-id="3374929874-13">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3374929874-14">[</span><span class="p" data-group-id="3374929874-15">{</span><span class="ss">session_id</span><span class="p">,</span><span class="w"> </span><span class="n">ID1</span><span class="p" data-group-id="3374929874-15">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3374929874-16">{</span><span class="ss">session_data</span><span class="p">,</span><span class="w"> </span><span class="n">SessData</span><span class="p" data-group-id="3374929874-16">}</span><span class="p" data-group-id="3374929874-14">]</span><span class="p" data-group-id="3374929874-13">}</span><span class="w"> </span><span class="o">=</span><span class="w">
        </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connection_information</span><span class="p" data-group-id="3374929874-17">(</span><span class="n">C9</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3374929874-18">[</span><span class="ss">session_id</span><span class="p">,</span><span class="w"> </span><span class="ss">session_data</span><span class="p" data-group-id="3374929874-18">]</span><span class="p" data-group-id="3374929874-17">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="3374929874-19">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="3374929874-20">[</span><span class="p" data-group-id="3374929874-21">{</span><span class="ss">session_id</span><span class="p">,</span><span class="p">&lt;&lt;</span><span class="mi">9</span><span class="p">,</span><span class="mi">233</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">54</span><span class="p">,</span><span class="mi">170</span><span class="p">,</span><span class="mi">88</span><span class="p">,</span><span class="mi">170</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">96</span><span class="p">,</span><span class="mi">202</span><span class="p">,</span><span class="w">
                   </span><span class="mi">85</span><span class="p">,</span><span class="mi">85</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">119</span><span class="p">,</span><span class="mi">47</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">68</span><span class="p">,</span><span class="mi">195</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">52</span><span class="p">,</span><span class="w">
                   </span><span class="mi">130</span><span class="p">,</span><span class="mi">239</span><span class="p">,</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">&gt;&gt;</span><span class="p" data-group-id="3374929874-21">}</span><span class="p">,</span><span class="w">
     </span><span class="p" data-group-id="3374929874-22">{</span><span class="ss">session_data</span><span class="p">,</span><span class="p">&lt;&lt;</span><span class="mi">131</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">115</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="mi">115</span><span class="p">,</span><span class="mi">115</span><span class="p">,</span><span class="mi">105</span><span class="p">,</span><span class="w">
                     </span><span class="mi">111</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">109</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">233</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">54</span><span class="p">,</span><span class="mi">170</span><span class="p">,</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">&gt;&gt;</span><span class="p" data-group-id="3374929874-22">}</span><span class="p" data-group-id="3374929874-20">]</span><span class="p" data-group-id="3374929874-19">}</span><span class="w">

</span><span class="c1">%% Explicitly reuse the session from C9</span><span class="gp unselectable">
13&gt; </span><span class="p" data-group-id="3374929874-23">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">C10</span><span class="p" data-group-id="3374929874-23">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="3374929874-24">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">9999</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3374929874-25">[</span><span class="p" data-group-id="3374929874-26">{</span><span class="ss">verify</span><span class="p">,</span><span class="w"> </span><span class="ss">verify_peer</span><span class="p" data-group-id="3374929874-26">}</span><span class="p">,</span><span class="w">
                                    </span><span class="p" data-group-id="3374929874-27">{</span><span class="ss">versions</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3374929874-28">[</span><span class="ss">&#39;tlsv1.2&#39;</span><span class="p" data-group-id="3374929874-28">]</span><span class="p" data-group-id="3374929874-27">}</span><span class="p">,</span><span class="w">
                                    </span><span class="p" data-group-id="3374929874-29">{</span><span class="ss">cacertfile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cacerts.pem&quot;</span><span class="p" data-group-id="3374929874-29">}</span><span class="p">,</span><span class="w">
                                    </span><span class="p" data-group-id="3374929874-30">{</span><span class="ss">reuse_session</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3374929874-31">{</span><span class="n">ID1</span><span class="p">,</span><span class="w"> </span><span class="n">SessData</span><span class="p" data-group-id="3374929874-31">}</span><span class="p" data-group-id="3374929874-30">}</span><span class="p" data-group-id="3374929874-25">]</span><span class="p" data-group-id="3374929874-24">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="3374929874-32">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="3374929874-33">{</span><span class="ss">sslsocket</span><span class="p">,</span><span class="p" data-group-id="3374929874-34">{</span><span class="ss">gen_tcp</span><span class="p">,</span><span class="p">#</span><span class="n">Port</span><span class="o">&lt;</span><span class="mf">0.15</span><span class="o">&gt;</span><span class="p">,</span><span class="ss">tls_connection</span><span class="p">,</span><span class="w">
                        </span><span class="ss">undefined</span><span class="p" data-group-id="3374929874-34">}</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="3374929874-33">}</span><span class="p" data-group-id="3374929874-32">}</span><span class="w">

</span><span class="mi">14</span><span class="o">&gt;</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connection_information</span><span class="p" data-group-id="3374929874-35">(</span><span class="n">C10</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3374929874-36">[</span><span class="ss">session_id</span><span class="p" data-group-id="3374929874-36">]</span><span class="p" data-group-id="3374929874-35">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="3374929874-37">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="3374929874-38">[</span><span class="p" data-group-id="3374929874-39">{</span><span class="ss">session_id</span><span class="p">,</span><span class="p">&lt;&lt;</span><span class="mi">9</span><span class="p">,</span><span class="mi">233</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">54</span><span class="p">,</span><span class="mi">170</span><span class="p">,</span><span class="mi">88</span><span class="p">,</span><span class="mi">170</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">96</span><span class="p">,</span><span class="mi">202</span><span class="p">,</span><span class="w">
                   </span><span class="mi">85</span><span class="p">,</span><span class="mi">85</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">119</span><span class="p">,</span><span class="mi">47</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">68</span><span class="p">,</span><span class="mi">195</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">52</span><span class="p">,</span><span class="w">
                   </span><span class="mi">130</span><span class="p">,</span><span class="mi">239</span><span class="p">,</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">&gt;&gt;</span><span class="p" data-group-id="3374929874-39">}</span><span class="p" data-group-id="3374929874-38">]</span><span class="p" data-group-id="3374929874-37">}</span></code></pre><p>Step 4 - Not Possible to Reuse Explicit Session by ID Only</p><pre><code class="makeup erlang" translate="no"><span class="c1">%% Try to reuse the session from C9 using only the id</span><span class="gp unselectable">
15&gt; </span><span class="p" data-group-id="1514605605-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="p" data-group-id="1514605605-1">}</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="1514605605-2">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">9999</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1514605605-3">[</span><span class="p" data-group-id="1514605605-4">{</span><span class="ss">verify</span><span class="p">,</span><span class="w"> </span><span class="ss">verify_peer</span><span class="p" data-group-id="1514605605-4">}</span><span class="p">,</span><span class="w">
                                    </span><span class="p" data-group-id="1514605605-5">{</span><span class="ss">versions</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1514605605-6">[</span><span class="ss">&#39;tlsv1.2&#39;</span><span class="p" data-group-id="1514605605-6">]</span><span class="p" data-group-id="1514605605-5">}</span><span class="p">,</span><span class="w">
                                    </span><span class="p" data-group-id="1514605605-7">{</span><span class="ss">cacertfile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cacerts.pem&quot;</span><span class="p" data-group-id="1514605605-7">}</span><span class="p">,</span><span class="w">
                                    </span><span class="p" data-group-id="1514605605-8">{</span><span class="ss">reuse_session</span><span class="p">,</span><span class="w"> </span><span class="n">ID1</span><span class="p" data-group-id="1514605605-8">}</span><span class="p" data-group-id="1514605605-3">]</span><span class="p" data-group-id="1514605605-2">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="1514605605-9">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="1514605605-10">{</span><span class="ss">sslsocket</span><span class="p">,</span><span class="p" data-group-id="1514605605-11">{</span><span class="ss">gen_tcp</span><span class="p">,</span><span class="p">#</span><span class="n">Port</span><span class="o">&lt;</span><span class="mf">0.18</span><span class="o">&gt;</span><span class="p">,</span><span class="ss">tls_connection</span><span class="p">,</span><span class="w">
                        </span><span class="ss">undefined</span><span class="p" data-group-id="1514605605-11">}</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="1514605605-10">}</span><span class="p" data-group-id="1514605605-9">}</span><span class="w">

</span><span class="c1">%% This will fail (as it is not saved for reuse)</span><span class="w">
</span><span class="c1">%% and a full handshake will be performed, we get a new id.</span><span class="gp unselectable">
16&gt; </span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connection_information</span><span class="p" data-group-id="1514605605-12">(</span><span class="n">E</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1514605605-13">[</span><span class="ss">session_id</span><span class="p" data-group-id="1514605605-13">]</span><span class="p" data-group-id="1514605605-12">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="1514605605-14">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="1514605605-15">[</span><span class="p" data-group-id="1514605605-16">{</span><span class="ss">session_id</span><span class="p">,</span><span class="p">&lt;&lt;</span><span class="mi">87</span><span class="p">,</span><span class="mi">46</span><span class="p">,</span><span class="mi">43</span><span class="p">,</span><span class="mi">126</span><span class="p">,</span><span class="mi">175</span><span class="p">,</span><span class="mi">68</span><span class="p">,</span><span class="mi">160</span><span class="p">,</span><span class="mi">153</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="w">
                   </span><span class="mi">196</span><span class="p">,</span><span class="mi">240</span><span class="p">,</span><span class="mi">65</span><span class="p">,</span><span class="mi">160</span><span class="p">,</span><span class="mi">254</span><span class="p">,</span><span class="mi">88</span><span class="p">,</span><span class="mi">65</span><span class="p">,</span><span class="mi">224</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">63</span><span class="p">,</span><span class="w">
                   </span><span class="mi">18</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">174</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p">&gt;&gt;</span><span class="p" data-group-id="1514605605-16">}</span><span class="p" data-group-id="1514605605-15">]</span><span class="p" data-group-id="1514605605-14">}</span></code></pre><p>On the server side the the <code class="inline">{reuse_sessions, boolean()}</code> option determines if
the server will save session data and allow session reuse or not. This can be
further customized by the option <code class="inline">{reuse_session, fun()}</code> that may introduce a
local policy for session reuse.</p><h2 id="session-tickets-and-session-resumption-in-tls-1-3" class="section-heading">
  <a href="#session-tickets-and-session-resumption-in-tls-1-3" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Session Tickets and Session Resumption in TLS 1.3</span>
</h2>
<p>TLS 1.3 introduces a new secure way of resuming sessions by using session
tickets. A session ticket is an opaque data structure that is sent in the
pre_shared_key extension of a ClientHello, when a client attempts to resume a
session with keying material from a previous successful handshake.</p><p>Session tickets can be stateful or stateless. A stateful session ticket is a
database reference (session ticket store) and used with stateful servers, while
a stateless ticket is a self-encrypted and self-authenticated data structure
with cryptographic keying material and state data, enabling session resumption
with stateless servers.</p><p>The choice between stateful or stateless depends on the server requirements as
the session tickets are opaque for the clients. Generally, stateful tickets are
smaller and the server can guarantee that tickets are only used once. Stateless
tickets contain additional data, require less storage on the server side, but
they offer different guarantees against anti-replay. See also
<a href="using_ssl.html#anti-replay-protection-in-tls-1-3">Anti-Replay Protection in TLS 1.3</a></p><p>Session tickets are sent by servers on newly established TLS connections. The
number of tickets sent and their lifetime are configurable by application
variables. See also <a href="ssl_app.html#configuration">SSL's configuration</a>.</p><p>Session tickets are protected by application traffic keys, and in stateless
tickets, the opaque data structure itself is self-encrypted.</p><p>An example with automatic and manual session resumption:</p><pre><code class="makeup erlang" translate="no"><span class="w">      </span><span class="p" data-group-id="6555538363-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="p" data-group-id="6555538363-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">application</span><span class="p">:</span><span class="nf">ensure_all_started</span><span class="p" data-group-id="6555538363-2">(</span><span class="ss">ssl</span><span class="p" data-group-id="6555538363-2">)</span><span class="p">.</span><span class="w">
      </span><span class="n">LOpts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6555538363-3">[</span><span class="p" data-group-id="6555538363-4">{</span><span class="ss">certs_keys</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6555538363-5">[</span><span class="p" data-group-id="6555538363-6">#{</span><span class="ss">certfile</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;cert.pem&quot;</span><span class="p">,</span><span class="w">
                               </span><span class="ss">keyfile</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;key.pem&quot;</span><span class="p" data-group-id="6555538363-6">}</span><span class="p" data-group-id="6555538363-5">]</span><span class="p" data-group-id="6555538363-4">}</span><span class="p">,</span><span class="w">
               </span><span class="p" data-group-id="6555538363-7">{</span><span class="ss">versions</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6555538363-8">[</span><span class="ss">&#39;tlsv1.2&#39;</span><span class="p">,</span><span class="ss">&#39;tlsv1.3&#39;</span><span class="p" data-group-id="6555538363-8">]</span><span class="p" data-group-id="6555538363-7">}</span><span class="p">,</span><span class="w">
               </span><span class="p" data-group-id="6555538363-9">{</span><span class="ss">session_tickets</span><span class="p">,</span><span class="w"> </span><span class="ss">stateless</span><span class="p" data-group-id="6555538363-9">}</span><span class="p" data-group-id="6555538363-3">]</span><span class="p">.</span><span class="w">
      </span><span class="p" data-group-id="6555538363-10">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSock</span><span class="p" data-group-id="6555538363-10">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="6555538363-11">(</span><span class="mi">8001</span><span class="p">,</span><span class="w"> </span><span class="n">LOpts</span><span class="p" data-group-id="6555538363-11">)</span><span class="p">.</span><span class="w">
      </span><span class="p" data-group-id="6555538363-12">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ASock</span><span class="p" data-group-id="6555538363-12">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">transport_accept</span><span class="p" data-group-id="6555538363-13">(</span><span class="n">LSock</span><span class="p" data-group-id="6555538363-13">)</span><span class="p">.</span></code></pre><p><em>Step 2 (client):</em> Start the client and connect to server:</p><pre><code class="makeup erlang" translate="no"><span class="w">      </span><span class="p" data-group-id="5379222971-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="p" data-group-id="5379222971-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">application</span><span class="p">:</span><span class="nf">ensure_all_started</span><span class="p" data-group-id="5379222971-2">(</span><span class="ss">ssl</span><span class="p" data-group-id="5379222971-2">)</span><span class="p">.</span><span class="w">
      </span><span class="n">COpts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5379222971-3">[</span><span class="p" data-group-id="5379222971-4">{</span><span class="ss">cacertfile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cert.pem&quot;</span><span class="p" data-group-id="5379222971-4">}</span><span class="p">,</span><span class="w">
               </span><span class="p" data-group-id="5379222971-5">{</span><span class="ss">versions</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5379222971-6">[</span><span class="ss">&#39;tlsv1.2&#39;</span><span class="p">,</span><span class="ss">&#39;tlsv1.3&#39;</span><span class="p" data-group-id="5379222971-6">]</span><span class="p" data-group-id="5379222971-5">}</span><span class="p">,</span><span class="w">
               </span><span class="p" data-group-id="5379222971-7">{</span><span class="ss">log_level</span><span class="p">,</span><span class="w"> </span><span class="ss">debug</span><span class="p" data-group-id="5379222971-7">}</span><span class="p">,</span><span class="w">
               </span><span class="p" data-group-id="5379222971-8">{</span><span class="ss">session_tickets</span><span class="p">,</span><span class="w"> </span><span class="ss">auto</span><span class="p" data-group-id="5379222971-8">}</span><span class="p" data-group-id="5379222971-3">]</span><span class="p">.</span><span class="w">
      </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="5379222971-9">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">8001</span><span class="p">,</span><span class="w"> </span><span class="n">COpts</span><span class="p" data-group-id="5379222971-9">)</span><span class="p">.</span></code></pre><p><em>Step 3 (server):</em> Start the TLS handshake:</p><pre><code class="makeup erlang" translate="no"><span class="w">      </span><span class="p" data-group-id="5162233886-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">CSocket</span><span class="p" data-group-id="5162233886-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">handshake</span><span class="p" data-group-id="5162233886-2">(</span><span class="n">ASock</span><span class="p" data-group-id="5162233886-2">)</span><span class="p">.</span></code></pre><p>A connection is established using a full handshake. Below is a summary of the
exchanged messages:</p><pre><code class="makeup erlang" translate="no"><span class="w">      </span><span class="p">&gt;&gt;</span><span class="o">&gt;</span><span class="w"> </span><span class="n">TLS</span><span class="w"> </span><span class="mf">1.3</span><span class="w"> </span><span class="n">Handshake</span><span class="p">,</span><span class="w"> </span><span class="n">ClientHello</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
      </span><span class="p">&lt;&lt;</span><span class="o">&lt;</span><span class="w"> </span><span class="n">TLS</span><span class="w"> </span><span class="mf">1.3</span><span class="w"> </span><span class="n">Handshake</span><span class="p">,</span><span class="w"> </span><span class="n">ServerHello</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
      </span><span class="p">&lt;&lt;</span><span class="o">&lt;</span><span class="w"> </span><span class="n">Handshake</span><span class="p">,</span><span class="w"> </span><span class="n">EncryptedExtensions</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
      </span><span class="p">&lt;&lt;</span><span class="o">&lt;</span><span class="w"> </span><span class="n">Handshake</span><span class="p">,</span><span class="w"> </span><span class="n">Certificate</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
      </span><span class="p">&lt;&lt;</span><span class="o">&lt;</span><span class="w"> </span><span class="n">Handshake</span><span class="p">,</span><span class="w"> </span><span class="n">CertificateVerify</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
      </span><span class="p">&lt;&lt;</span><span class="o">&lt;</span><span class="w"> </span><span class="n">Handshake</span><span class="p">,</span><span class="w"> </span><span class="n">Finished</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
      </span><span class="p">&gt;&gt;</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Handshake</span><span class="p">,</span><span class="w"> </span><span class="n">Finished</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
      </span><span class="p">&lt;&lt;</span><span class="o">&lt;</span><span class="w"> </span><span class="n">Post</span><span class="o">-</span><span class="n">Handshake</span><span class="p">,</span><span class="w"> </span><span class="n">NewSessionTicket</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span></code></pre><p>At this point the client has stored the received session tickets and ready to
use them when establishing new connections to the same server.</p><p><em>Step 4 (server):</em> Accept a new connection on the server:</p><pre><code class="makeup erlang" translate="no"><span class="w">      </span><span class="p" data-group-id="4376794231-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ASock2</span><span class="p" data-group-id="4376794231-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">transport_accept</span><span class="p" data-group-id="4376794231-2">(</span><span class="n">LSock</span><span class="p" data-group-id="4376794231-2">)</span><span class="p">.</span></code></pre><p><em>Step 5 (client):</em> Make a new connection:</p><pre><code class="makeup erlang" translate="no"><span class="w">      </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="0245691716-1">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">8001</span><span class="p">,</span><span class="w"> </span><span class="n">COpts</span><span class="p" data-group-id="0245691716-1">)</span><span class="p">.</span></code></pre><p><em>Step 6 (server):</em> Start the handshake:</p><pre><code class="makeup erlang" translate="no"><span class="w">      </span><span class="p" data-group-id="6660647672-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">CSock2</span><span class="p" data-group-id="6660647672-1">}</span><span class="w"> </span><span class="o">=</span><span class="nc">ssl</span><span class="p">:</span><span class="nf">handshake</span><span class="p" data-group-id="6660647672-2">(</span><span class="n">ASock2</span><span class="p" data-group-id="6660647672-2">)</span><span class="p">.</span></code></pre><p>The second connection is a session resumption using keying material from the
previous handshake:</p><pre><code class="makeup erlang" translate="no"><span class="w">      </span><span class="p">&gt;&gt;</span><span class="o">&gt;</span><span class="w"> </span><span class="n">TLS</span><span class="w"> </span><span class="mf">1.3</span><span class="w"> </span><span class="n">Handshake</span><span class="p">,</span><span class="w"> </span><span class="n">ClientHello</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
      </span><span class="p">&lt;&lt;</span><span class="o">&lt;</span><span class="w"> </span><span class="n">TLS</span><span class="w"> </span><span class="mf">1.3</span><span class="w"> </span><span class="n">Handshake</span><span class="p">,</span><span class="w"> </span><span class="n">ServerHello</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
      </span><span class="p">&lt;&lt;</span><span class="o">&lt;</span><span class="w"> </span><span class="n">Handshake</span><span class="p">,</span><span class="w"> </span><span class="n">EncryptedExtensions</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
      </span><span class="p">&lt;&lt;</span><span class="o">&lt;</span><span class="w"> </span><span class="n">Handshake</span><span class="p">,</span><span class="w"> </span><span class="n">Finished</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
      </span><span class="p">&gt;&gt;</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Handshake</span><span class="p">,</span><span class="w"> </span><span class="n">Finished</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="w">
      </span><span class="p">&lt;&lt;</span><span class="o">&lt;</span><span class="w"> </span><span class="n">Post</span><span class="o">-</span><span class="n">Handshake</span><span class="p">,</span><span class="w"> </span><span class="n">NewSessionTicket</span><span class="w"> </span><span class="p">.</span><span class="p">.</span><span class="p">.</span></code></pre><p>Manual handling of session tickets is also supported. In manual mode, it is the
responsibility of the client to handle received session tickets.</p><p><em>Step 7 (server):</em> Accept a new connection on the server:</p><pre><code class="makeup erlang" translate="no"><span class="w">      </span><span class="p" data-group-id="9733440613-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ASock3</span><span class="p" data-group-id="9733440613-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">transport_accept</span><span class="p" data-group-id="9733440613-2">(</span><span class="n">LSock</span><span class="p" data-group-id="9733440613-2">)</span><span class="p">.</span></code></pre><p><em>Step 8 (client):</em> Make a new connection to server:</p><pre><code class="makeup erlang" translate="no"><span class="w">      </span><span class="p" data-group-id="5258960589-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="p" data-group-id="5258960589-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">application</span><span class="p">:</span><span class="nf">ensure_all_started</span><span class="p" data-group-id="5258960589-2">(</span><span class="ss">ssl</span><span class="p" data-group-id="5258960589-2">)</span><span class="p">.</span><span class="w">
      </span><span class="n">COpts2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5258960589-3">[</span><span class="p" data-group-id="5258960589-4">{</span><span class="ss">cacertfile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cacerts.pem&quot;</span><span class="p" data-group-id="5258960589-4">}</span><span class="p">,</span><span class="w">
                </span><span class="p" data-group-id="5258960589-5">{</span><span class="ss">versions</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5258960589-6">[</span><span class="ss">&#39;tlsv1.2&#39;</span><span class="p">,</span><span class="ss">&#39;tlsv1.3&#39;</span><span class="p" data-group-id="5258960589-6">]</span><span class="p" data-group-id="5258960589-5">}</span><span class="p">,</span><span class="w">
                </span><span class="p" data-group-id="5258960589-7">{</span><span class="ss">log_level</span><span class="p">,</span><span class="w"> </span><span class="ss">debug</span><span class="p" data-group-id="5258960589-7">}</span><span class="p">,</span><span class="w">
                </span><span class="p" data-group-id="5258960589-8">{</span><span class="ss">session_tickets</span><span class="p">,</span><span class="w"> </span><span class="ss">manual</span><span class="p" data-group-id="5258960589-8">}</span><span class="p" data-group-id="5258960589-3">]</span><span class="p">.</span><span class="w">
      </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="5258960589-9">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">8001</span><span class="p">,</span><span class="w"> </span><span class="n">COpts</span><span class="p" data-group-id="5258960589-9">)</span><span class="p">.</span></code></pre><p><em>Step 9 (server):</em> Start the handshake:</p><pre><code class="makeup erlang" translate="no"><span class="w">      </span><span class="p" data-group-id="1816152999-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">CSock3</span><span class="p" data-group-id="1816152999-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">handshake</span><span class="p" data-group-id="1816152999-2">(</span><span class="n">ASock3</span><span class="p" data-group-id="1816152999-2">)</span><span class="p">.</span></code></pre><p>After the handshake is performed, the user process receivess messages with the
tickets sent by the server.</p><p><em>Step 10 (client):</em> Receive a new session ticket:</p><pre><code class="makeup erlang" translate="no"><span class="w">      </span><span class="n">Ticket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">receive</span><span class="w"> </span><span class="p" data-group-id="0836400136-1">{</span><span class="ss">ssl</span><span class="p">,</span><span class="w"> </span><span class="ss">session_ticket</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0836400136-2">{</span><span class="p">_</span><span class="p">,</span><span class="w"> </span><span class="n">TicketData</span><span class="p" data-group-id="0836400136-2">}</span><span class="p" data-group-id="0836400136-1">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="n">TicketData</span><span class="w"> </span><span class="k">end</span><span class="p">.</span></code></pre><p><em>Step 11 (server):</em> Accept a new connection on the server:</p><pre><code class="makeup erlang" translate="no"><span class="w">      </span><span class="p" data-group-id="4764643836-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ASock4</span><span class="p" data-group-id="4764643836-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">transport_accept</span><span class="p" data-group-id="4764643836-2">(</span><span class="n">LSock</span><span class="p" data-group-id="4764643836-2">)</span><span class="p">.</span></code></pre><p><em>Step 12 (client):</em> Initiate a new connection to the server with the session
ticket received in Step 10:</p><pre><code class="makeup erlang" translate="no"><span class="w">      </span><span class="p" data-group-id="0769525236-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="p" data-group-id="0769525236-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">application</span><span class="p">:</span><span class="nf">ensure_all_started</span><span class="p" data-group-id="0769525236-2">(</span><span class="ss">ssl</span><span class="p" data-group-id="0769525236-2">)</span><span class="p">.</span><span class="w">
      </span><span class="n">COpts2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0769525236-3">[</span><span class="p" data-group-id="0769525236-4">{</span><span class="ss">cacertfile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cert.pem&quot;</span><span class="p" data-group-id="0769525236-4">}</span><span class="p">,</span><span class="w">
                </span><span class="p" data-group-id="0769525236-5">{</span><span class="ss">versions</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0769525236-6">[</span><span class="ss">&#39;tlsv1.2&#39;</span><span class="p">,</span><span class="ss">&#39;tlsv1.3&#39;</span><span class="p" data-group-id="0769525236-6">]</span><span class="p" data-group-id="0769525236-5">}</span><span class="p">,</span><span class="w">
                </span><span class="p" data-group-id="0769525236-7">{</span><span class="ss">log_level</span><span class="p">,</span><span class="w"> </span><span class="ss">debug</span><span class="p" data-group-id="0769525236-7">}</span><span class="p">,</span><span class="w">
                </span><span class="p" data-group-id="0769525236-8">{</span><span class="ss">session_tickets</span><span class="p">,</span><span class="w"> </span><span class="ss">manual</span><span class="p" data-group-id="0769525236-8">}</span><span class="p">,</span><span class="w">
                </span><span class="p" data-group-id="0769525236-9">{</span><span class="ss">use_ticket</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0769525236-10">[</span><span class="n">Ticket</span><span class="p" data-group-id="0769525236-10">]</span><span class="p" data-group-id="0769525236-9">}</span><span class="p" data-group-id="0769525236-3">]</span><span class="p">.</span><span class="w">
      </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="0769525236-11">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">8001</span><span class="p">,</span><span class="w"> </span><span class="n">COpts</span><span class="p" data-group-id="0769525236-11">)</span><span class="p">.</span></code></pre><p><em>Step 13 (server):</em> Start the handshake:</p><pre><code class="makeup erlang" translate="no"><span class="w">      </span><span class="p" data-group-id="2632752762-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">CSock4</span><span class="p" data-group-id="2632752762-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">handshake</span><span class="p" data-group-id="2632752762-2">(</span><span class="n">ASock4</span><span class="p" data-group-id="2632752762-2">)</span><span class="p">.</span></code></pre><h2 id="early-data-in-tls-1-3" class="section-heading">
  <a href="#early-data-in-tls-1-3" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Early Data in TLS-1.3</span>
</h2>
<p>TLS 1.3 allows clients to send data on the first flight if the endpoints have a
shared crypographic secret (pre-shared key). This means that clients can send
early data if they have a valid session ticket received in a previous successful
handshake. For more information about session resumption see
<a href="using_ssl.html#session-tickets-and-session-resumption-in-tls-1-3">Session Tickets and Session Resumption in TLS 1.3</a>.</p><p>The security properties of Early Data are weaker than other kinds of TLS data.
This data is not forward secret, and it is vulnerable to replay attacks. For
available mitigation strategies see
<a href="using_ssl.html#anti-replay-protection-in-tls-1-3">Anti-Replay Protection in TLS 1.3</a>.</p><p>In normal operation, clients will not know which, if any, of the available
mitigation strategies servers actually implement, and hence must only send early
data which they deem safe to be replayed. For example, idempotent HTTP
operations, such as HEAD and GET, can usually be regarded as safe but even they
can be exploited by a large number of replays causing resource limit exhaustion
and other similar problems.</p><p>An example of sending early data with automatic and manual session ticket
handling:</p><p><em>Server</em></p><pre><code class="makeup erlang" translate="no"><span class="nf">early_data_server</span><span class="p" data-group-id="7480742481-1">(</span><span class="p" data-group-id="7480742481-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="nc">application</span><span class="p">:</span><span class="nf">load</span><span class="p" data-group-id="7480742481-2">(</span><span class="ss">ssl</span><span class="p" data-group-id="7480742481-2">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7480742481-3">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="p" data-group-id="7480742481-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">application</span><span class="p">:</span><span class="nf">ensure_all_started</span><span class="p" data-group-id="7480742481-4">(</span><span class="ss">ssl</span><span class="p" data-group-id="7480742481-4">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11029</span><span class="p">,</span><span class="w">
    </span><span class="n">LOpts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7480742481-5">[</span><span class="p" data-group-id="7480742481-6">{</span><span class="ss">certs_keys</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7480742481-7">[</span><span class="p" data-group-id="7480742481-8">#{</span><span class="ss">certfile</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;cert.pem&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">keyfile</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="s">&quot;key.pem&quot;</span><span class="p" data-group-id="7480742481-8">}</span><span class="p" data-group-id="7480742481-7">]</span><span class="p" data-group-id="7480742481-6">}</span><span class="p">,</span><span class="w">
             </span><span class="p" data-group-id="7480742481-9">{</span><span class="ss">reuseaddr</span><span class="p">,</span><span class="w"> </span><span class="ss">true</span><span class="p" data-group-id="7480742481-9">}</span><span class="p">,</span><span class="w">
             </span><span class="p" data-group-id="7480742481-10">{</span><span class="ss">versions</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7480742481-11">[</span><span class="ss">&#39;tlsv1.2&#39;</span><span class="p">,</span><span class="ss">&#39;tlsv1.3&#39;</span><span class="p" data-group-id="7480742481-11">]</span><span class="p" data-group-id="7480742481-10">}</span><span class="p">,</span><span class="w">
             </span><span class="p" data-group-id="7480742481-12">{</span><span class="ss">session_tickets</span><span class="p">,</span><span class="w"> </span><span class="ss">stateless</span><span class="p" data-group-id="7480742481-12">}</span><span class="p">,</span><span class="w">
             </span><span class="p" data-group-id="7480742481-13">{</span><span class="ss">early_data</span><span class="p">,</span><span class="w"> </span><span class="ss">enabled</span><span class="p" data-group-id="7480742481-13">}</span><span class="p">,</span><span class="w">
            </span><span class="p" data-group-id="7480742481-5">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7480742481-14">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">LSock</span><span class="p" data-group-id="7480742481-14">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">listen</span><span class="p" data-group-id="7480742481-15">(</span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="n">LOpts</span><span class="p" data-group-id="7480742481-15">)</span><span class="p">,</span><span class="w">
    </span><span class="c1">%% Accept first connection</span><span class="w">
    </span><span class="p" data-group-id="7480742481-16">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ASock0</span><span class="p" data-group-id="7480742481-16">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">transport_accept</span><span class="p" data-group-id="7480742481-17">(</span><span class="n">LSock</span><span class="p" data-group-id="7480742481-17">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7480742481-18">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">CSock0</span><span class="p" data-group-id="7480742481-18">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">handshake</span><span class="p" data-group-id="7480742481-19">(</span><span class="n">ASock0</span><span class="p" data-group-id="7480742481-19">)</span><span class="p">,</span><span class="w">
    </span><span class="c1">%% Accept second connection</span><span class="w">
    </span><span class="p" data-group-id="7480742481-20">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">ASock1</span><span class="p" data-group-id="7480742481-20">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">transport_accept</span><span class="p" data-group-id="7480742481-21">(</span><span class="n">LSock</span><span class="p" data-group-id="7480742481-21">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7480742481-22">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">CSock1</span><span class="p" data-group-id="7480742481-22">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">handshake</span><span class="p" data-group-id="7480742481-23">(</span><span class="n">ASock1</span><span class="p" data-group-id="7480742481-23">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Sock</span><span class="p">.</span></code></pre><p><em>Client (automatic ticket handling):</em></p><pre><code class="makeup erlang" translate="no"><span class="nf">early_data_auto</span><span class="p" data-group-id="3768786381-1">(</span><span class="p" data-group-id="3768786381-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="c1">%% First handshake 1-RTT - get session tickets</span><span class="w">
    </span><span class="nc">application</span><span class="p">:</span><span class="nf">load</span><span class="p" data-group-id="3768786381-2">(</span><span class="ss">ssl</span><span class="p" data-group-id="3768786381-2">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="3768786381-3">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="p" data-group-id="3768786381-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">application</span><span class="p">:</span><span class="nf">ensure_all_started</span><span class="p" data-group-id="3768786381-4">(</span><span class="ss">ssl</span><span class="p" data-group-id="3768786381-4">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11029</span><span class="p">,</span><span class="w">
    </span><span class="n">Data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&lt;&lt;</span><span class="s">&quot;HEAD / HTTP/1.1\r\nHost: \r\nConnection: close\r\n&quot;</span><span class="p">&gt;&gt;</span><span class="p">,</span><span class="w">
    </span><span class="n">COpts0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3768786381-5">[</span><span class="p" data-group-id="3768786381-6">{</span><span class="ss">cacertfile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cacerts.pem&quot;</span><span class="p" data-group-id="3768786381-6">}</span><span class="p">,</span><span class="w">
              </span><span class="p" data-group-id="3768786381-7">{</span><span class="ss">versions</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3768786381-8">[</span><span class="ss">&#39;tlsv1.2&#39;</span><span class="p">,</span><span class="w"> </span><span class="ss">&#39;tlsv1.3&#39;</span><span class="p" data-group-id="3768786381-8">]</span><span class="p" data-group-id="3768786381-7">}</span><span class="p">,</span><span class="w">
              </span><span class="p" data-group-id="3768786381-9">{</span><span class="ss">session_tickets</span><span class="p">,</span><span class="w"> </span><span class="ss">auto</span><span class="p" data-group-id="3768786381-9">}</span><span class="p" data-group-id="3768786381-5">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="3768786381-10">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Sock0</span><span class="p" data-group-id="3768786381-10">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="3768786381-11">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="n">COpts0</span><span class="p" data-group-id="3768786381-11">)</span><span class="p">,</span><span class="w">

    </span><span class="c1">%% Wait for session tickets</span><span class="w">
    </span><span class="nc">timer</span><span class="p">:</span><span class="nf">sleep</span><span class="p" data-group-id="3768786381-12">(</span><span class="mi">500</span><span class="p" data-group-id="3768786381-12">)</span><span class="p">,</span><span class="w">
    </span><span class="c1">%% Close socket if server cannot handle multiple</span><span class="w">
    </span><span class="c1">%% connections e.g. openssl s_server</span><span class="w">
    </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">close</span><span class="p" data-group-id="3768786381-13">(</span><span class="n">Sock0</span><span class="p" data-group-id="3768786381-13">)</span><span class="p">,</span><span class="w">

    </span><span class="c1">%% Second handshake 0-RTT</span><span class="w">
    </span><span class="n">COpts1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3768786381-14">[</span><span class="p" data-group-id="3768786381-15">{</span><span class="ss">cacertfile</span><span class="p">,</span><span class="w">  </span><span class="s">&quot;cacerts.pem&quot;</span><span class="p" data-group-id="3768786381-15">}</span><span class="p">,</span><span class="w">
              </span><span class="p" data-group-id="3768786381-16">{</span><span class="ss">versions</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3768786381-17">[</span><span class="ss">&#39;tlsv1.2&#39;</span><span class="p">,</span><span class="w"> </span><span class="ss">&#39;tlsv1.3&#39;</span><span class="p" data-group-id="3768786381-17">]</span><span class="p" data-group-id="3768786381-16">}</span><span class="p">,</span><span class="w">
              </span><span class="p" data-group-id="3768786381-18">{</span><span class="ss">session_tickets</span><span class="p">,</span><span class="w"> </span><span class="ss">auto</span><span class="p" data-group-id="3768786381-18">}</span><span class="p">,</span><span class="w">
              </span><span class="p" data-group-id="3768786381-19">{</span><span class="ss">early_data</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="3768786381-19">}</span><span class="p" data-group-id="3768786381-14">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="3768786381-20">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Sock</span><span class="p" data-group-id="3768786381-20">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="3768786381-21">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="n">COpts1</span><span class="p" data-group-id="3768786381-21">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Sock</span><span class="p">.</span><span class="w">
</span></code></pre><p><em>Client (manual ticket handling):</em></p><pre><code class="makeup erlang" translate="no"><span class="nf">early_data_manual</span><span class="p" data-group-id="0783638811-1">(</span><span class="p" data-group-id="0783638811-1">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
    </span><span class="c1">%% First handshake 1-RTT - get session tickets</span><span class="w">
    </span><span class="nc">application</span><span class="p">:</span><span class="nf">load</span><span class="p" data-group-id="0783638811-2">(</span><span class="ss">ssl</span><span class="p" data-group-id="0783638811-2">)</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="0783638811-3">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="p" data-group-id="0783638811-3">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">application</span><span class="p">:</span><span class="nf">ensure_all_started</span><span class="p" data-group-id="0783638811-4">(</span><span class="ss">ssl</span><span class="p" data-group-id="0783638811-4">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11029</span><span class="p">,</span><span class="w">
    </span><span class="n">Data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&lt;&lt;</span><span class="s">&quot;HEAD / HTTP/1.1\r\nHost: \r\nConnection: close\r\n&quot;</span><span class="p">&gt;&gt;</span><span class="p">,</span><span class="w">
    </span><span class="n">COpts0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0783638811-5">[</span><span class="p" data-group-id="0783638811-6">{</span><span class="ss">cacertfile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cacerts.pem&quot;</span><span class="p" data-group-id="0783638811-6">}</span><span class="p">,</span><span class="w">
              </span><span class="p" data-group-id="0783638811-7">{</span><span class="ss">versions</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0783638811-8">[</span><span class="ss">&#39;tlsv1.2&#39;</span><span class="p">,</span><span class="w"> </span><span class="ss">&#39;tlsv1.3&#39;</span><span class="p" data-group-id="0783638811-8">]</span><span class="p" data-group-id="0783638811-7">}</span><span class="p">,</span><span class="w">
              </span><span class="p" data-group-id="0783638811-9">{</span><span class="ss">session_tickets</span><span class="p">,</span><span class="w"> </span><span class="ss">manual</span><span class="p" data-group-id="0783638811-9">}</span><span class="p" data-group-id="0783638811-5">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="0783638811-10">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Sock0</span><span class="p" data-group-id="0783638811-10">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="0783638811-11">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="n">COpts0</span><span class="p" data-group-id="0783638811-11">)</span><span class="p">,</span><span class="w">

    </span><span class="c1">%% Wait for session tickets</span><span class="w">
    </span><span class="n">Ticket</span><span class="w"> </span><span class="o">=</span><span class="w">
        </span><span class="k">receive</span><span class="w">
            </span><span class="p" data-group-id="0783638811-12">{</span><span class="ss">ssl</span><span class="p">,</span><span class="w"> </span><span class="ss">session_ticket</span><span class="p">,</span><span class="w"> </span><span class="n">Ticket0</span><span class="p" data-group-id="0783638811-12">}</span><span class="w"> </span><span class="p">-&gt;</span><span class="w">
                </span><span class="n">Ticket0</span><span class="w">
        </span><span class="k">end</span><span class="p">,</span><span class="w">

    </span><span class="c1">%% Close socket if server cannot handle multiple connections</span><span class="w">
    </span><span class="c1">%% e.g. openssl s_server</span><span class="w">
    </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">close</span><span class="p" data-group-id="0783638811-13">(</span><span class="n">Sock0</span><span class="p" data-group-id="0783638811-13">)</span><span class="p">,</span><span class="w">

    </span><span class="c1">%% Second handshake 0-RTT</span><span class="w">
    </span><span class="n">COpts1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0783638811-14">[</span><span class="p" data-group-id="0783638811-15">{</span><span class="ss">cacertfile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cacerts.pem&quot;</span><span class="p" data-group-id="0783638811-15">}</span><span class="p">,</span><span class="w">
              </span><span class="p" data-group-id="0783638811-16">{</span><span class="ss">versions</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0783638811-17">[</span><span class="ss">&#39;tlsv1.2&#39;</span><span class="p">,</span><span class="w"> </span><span class="ss">&#39;tlsv1.3&#39;</span><span class="p" data-group-id="0783638811-17">]</span><span class="p" data-group-id="0783638811-16">}</span><span class="p">,</span><span class="w">
              </span><span class="p" data-group-id="0783638811-18">{</span><span class="ss">session_tickets</span><span class="p">,</span><span class="w"> </span><span class="ss">manual</span><span class="p" data-group-id="0783638811-18">}</span><span class="p">,</span><span class="w">
              </span><span class="p" data-group-id="0783638811-19">{</span><span class="ss">use_ticket</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0783638811-20">[</span><span class="n">Ticket</span><span class="p" data-group-id="0783638811-20">]</span><span class="p" data-group-id="0783638811-19">}</span><span class="p">,</span><span class="w">
              </span><span class="p" data-group-id="0783638811-21">{</span><span class="ss">early_data</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="p" data-group-id="0783638811-21">}</span><span class="p" data-group-id="0783638811-14">]</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="0783638811-22">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Sock</span><span class="p" data-group-id="0783638811-22">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="0783638811-23">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Port</span><span class="p">,</span><span class="w"> </span><span class="n">COpts1</span><span class="p" data-group-id="0783638811-23">)</span><span class="p">,</span><span class="w">
    </span><span class="n">Sock</span><span class="p">.</span></code></pre><h2 id="anti-replay-protection-in-tls-1-3" class="section-heading">
  <a href="#anti-replay-protection-in-tls-1-3" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Anti-Replay Protection in TLS 1.3</span>
</h2>
<p>The TLS 1.3 protocol does not provide inherent protection for replay of 0-RTT
data but describes mechanisms that SHOULD be implemented by compliant server
implementations. The implementation of TLS 1.3 in the SSL application employs
all standard methods to prevent potential threats.</p><p><em>Single-use tickets</em></p><p>This mechanism is available with stateful session tickets. Session tickets can
only be used once, subsequent use of the same ticket results in a full
handshake. Stateful servers enforce this rule by maintaining a database of
outstanding valid tickets.</p><p><em>Client Hello Recording</em></p><p>This mechanism is available with stateless session tickets. The server records a
unique value derived from the ClientHello (PSK binder) in a given time window.
The ticket's age is verified by using both the &quot;obsfuscated_ticket_age&quot; and an
additional timestamp encrypted in the ticket data. As the used datastore allows
false positives, apparent replays will be answered by doing a full 1-RTT
handshake.</p><p><em>Freshness Checks</em></p><p>This mechanism is available with the stateless session tickets. As the ticket
data has an embedded timestamp, the server can determine if a ClientHello was
sent reasonably recently and accept the 0-RTT handshake, otherwise if falls back
to a full 1-RTT handshake. This mechanism is tightly coupled with the previous
one, it prevents storing an unlimited number of ClientHellos.</p><p>The current implementation uses a pair of Bloom filters to implement the last
two mechanisms. Bloom filters are fast, memory-efficient, probabilistic data
structures that can tell if an element may be in a set or if it is definitely
not in the set.</p><p>If the option <code class="inline">anti_replay</code> is defined in the server, a
pair of Bloom filters (<em>current</em> and <em>old</em>) are used to record incoming
ClientHello messages (it is the unique binder value that is actually stored).
The <em>current</em> Bloom filter is used for <code class="inline">WindowSize</code> seconds to store new
elements. At the end of the time window the Bloom filters are rotated (the
<em>current</em> Bloom filter becomes the <em>old</em> and an empty Bloom filter is set as
<em>current</em>.</p><p>The Anti-Replay protection feature in stateless servers executes in the
following steps when a new ClientHello is received:</p><ul><li>Reported ticket age (obfuscated ticket age) shall be less than ticket
lifetime.</li><li>Actual ticket age shall be less than the ticket lifetime (stateless session
tickets contain the servers timestamp when the ticket was issued).</li><li>ClientHello created with the ticket shall be sent relatively recently
(freshness checks).</li><li>If all above checks passed both <em>current</em> and <em>old</em> Bloom filters are checked
to detect if binder was already seen. Being a probabilistic data structure,
false positives can occur and they trigger a full handshake.</li><li>If the binder is not seen, the binder is validated. If the binder is valid,
the server proceeds with the 0-RTT handshake.</li></ul><h2 id="using-dtls" class="section-heading">
  <a href="#using-dtls" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Using DTLS</span>
</h2>
<p>Using DTLS has basically the same API as TLS. You need to add the option
{protocol, dtls} to the connect and listen functions. For example</p><pre><code class="makeup erlang" translate="no"><span class="w"> </span><span class="ss">client</span><span class="o">&gt;</span><span class="p" data-group-id="4449312144-1">{</span><span class="ss">ok</span><span class="p">,</span><span class="w"> </span><span class="n">Socket</span><span class="p" data-group-id="4449312144-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">ssl</span><span class="p">:</span><span class="nf">connect</span><span class="p" data-group-id="4449312144-2">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">9999</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4449312144-3">[</span><span class="p" data-group-id="4449312144-4">{</span><span class="ss">protocol</span><span class="p">,</span><span class="w"> </span><span class="ss">dtls</span><span class="p" data-group-id="4449312144-4">}</span><span class="p">,</span><span class="w">
                                               </span><span class="p" data-group-id="4449312144-5">{</span><span class="ss">verify</span><span class="p">,</span><span class="w"> </span><span class="ss">verify_peer</span><span class="p" data-group-id="4449312144-5">}</span><span class="p">,</span><span class="w">
                                               </span><span class="p" data-group-id="4449312144-6">{</span><span class="ss">cacertfile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cacerts.pem&quot;</span><span class="p" data-group-id="4449312144-6">}</span><span class="p" data-group-id="4449312144-3">]</span><span class="p">,</span><span class="w">
                           </span><span class="ss">infinity</span><span class="p" data-group-id="4449312144-2">)</span><span class="p">.</span><span class="w">
</span><span class="p" data-group-id="4449312144-7">{</span><span class="ss">ok</span><span class="p">,</span><span class="p" data-group-id="4449312144-8">{</span><span class="ss">sslsocket</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4449312144-9">[</span><span class="p">.</span><span class="p">.</span><span class="p">.</span><span class="p" data-group-id="4449312144-9">]</span><span class="p" data-group-id="4449312144-8">}</span><span class="p" data-group-id="4449312144-7">}</span><span class="w">
</span></code></pre>
</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="ssl_protocol.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
TLS/DTLS Protocol Overview
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="ssl_distribution.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Erlang Distribution over TLS
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="ssl.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.34.1) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>
<p>Copyright © 1996-2024 <a href="https://www.ericsson.com">Ericsson AB</a></p>
    </footer>
  </div>
</main>
</div>
<script>
  function mermaidLoaded() {
    mermaid.initialize({
      startOnLoad: false,
      theme: document.body.className.includes("dark") ? "dark" : "default"
    });
    let id = 0;
    for (const codeEl of document.querySelectorAll("pre code.mermaid")) {
      const preEl = codeEl.parentElement;
      const graphDefinition = codeEl.textContent;
      const graphEl = document.createElement("div");
      const graphId = "mermaid-graph-" + id++;
      mermaid.render(graphId, graphDefinition).then(({svg, bindFunctions}) => {
        graphEl.innerHTML = svg;
        bindFunctions?.(graphEl);
        preEl.insertAdjacentElement("afterend", graphEl);
        preEl.remove();
      });
    }
  }
</script>
<script async src="https://cdn.jsdelivr.net/npm/mermaid@10.2.3/dist/mermaid.min.js" onload="mermaidLoaded();"></script>

  </body>
</html>
